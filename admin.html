<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åå°ç®¡ç† - PHOTOGRAPHER</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Admin Specific Styles */
        :root {
            --sidebar-width: 260px;
            --header-height: 60px;
            --primary-color: #1a1a1a;
            --secondary-color: #333;
            --accent-color: #0066cc;
            --danger-color: #dc3545;
            --success-color: #28a745;
            --bg-color: #f5f5f5;
            --card-bg: #ffffff;
            --border-color: #e5e5e5;
            --text-primary: #1a1a1a;
            --text-secondary: #666;
            --text-muted: #999;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            font-size: 14px;
            line-height: 1.5;
            color: var(--text-primary);
            background: var(--bg-color);
        }

        /* Admin Layout */
        .admin-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--primary-color);
            color: #fff;
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            z-index: 100;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 24px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .sidebar-header h1 {
            font-size: 18px;
            font-weight: 700;
            letter-spacing: 0.1em;
            margin-bottom: 4px;
        }

        .sidebar-header p {
            font-size: 12px;
            color: rgba(255,255,255,0.6);
        }

        .sidebar-nav {
            flex: 1;
            padding: 16px 0;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 24px;
            color: rgba(255,255,255,0.7);
            cursor: pointer;
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
        }

        .nav-item:hover {
            color: #fff;
            background: rgba(255,255,255,0.05);
        }

        .nav-item.active {
            color: #fff;
            background: rgba(255,255,255,0.1);
            border-left-color: #fff;
        }

        .nav-icon {
            font-size: 18px;
        }

        /* Banner Management Styles */
        .banner-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .banner-item {
            display: flex;
            gap: 20px;
            padding: 20px;
            background: var(--bg-color);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .banner-item:nth-child(even) {
            background: var(--white);
        }

        .banner-preview {
            width: 200px;
            height: 120px;
            flex-shrink: 0;
            border-radius: 6px;
            overflow: hidden;
            background: #000;
        }

        .banner-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .banner-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .banner-info .form-group {
            margin-bottom: 0;
        }

        .banner-info input[type="text"] {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 14px;
        }

        .banner-info input[type="text"]:focus {
            outline: none;
            border-color: var(--accent-color);
        }

        @media (max-width: 768px) {
            .banner-item {
                flex-direction: column;
            }

            .banner-preview {
                width: 100%;
                height: 180px;
            }
        }

        .sidebar-footer {
            padding: 16px 24px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .view-site-btn {
            display: block;
            text-align: center;
            padding: 12px;
            background: rgba(255,255,255,0.1);
            color: #fff;
            border-radius: 6px;
            text-decoration: none;
            transition: all 0.2s ease;
        }

        .view-site-btn:hover {
            background: rgba(255,255,255,0.2);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            padding: 32px;
            min-height: 100vh;
        }

        /* Page Sections */
        .admin-page {
            display: none;
        }

        .admin-page.active {
            display: block;
        }

        .page-header {
            margin-bottom: 32px;
        }

        .page-header h2 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .page-header p {
            color: var(--text-secondary);
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: var(--card-bg);
            padding: 24px;
            border-radius: 10px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            display: flex;
            align-items: center;
            gap: 16px;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .stat-icon {
            font-size: 36px;
        }

        .stat-number {
            display: block;
            font-size: 32px;
            font-weight: 700;
            line-height: 1.2;
        }

        .stat-label {
            font-size: 13px;
            color: var(--text-secondary);
        }

        /* Cards */
        .card {
            background: var(--card-bg);
            padding: 24px;
            border-radius: 10px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            margin-bottom: 24px;
        }

        .card h3 {
            margin-bottom: 16px;
            font-size: 18px;
        }

        /* Grid Layouts */
        .grid-2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        @media (max-width: 768px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        /* Buttons */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background: var(--primary-color);
            color: #fff;
        }

        .btn-primary:hover {
            background: var(--secondary-color);
        }

        .btn-secondary {
            background: #fff;
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--bg-color);
        }

        .btn-danger {
            background: var(--danger-color);
            color: #fff;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }

        /* Image Upload */
        .image-upload {
            position: relative;
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            height: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .image-upload:hover {
            border-color: var(--primary-color);
        }

        .image-upload input {
            position: absolute;
            inset: 0;
            opacity: 0;
            cursor: pointer;
        }

        .image-upload.has-image {
            border-style: solid;
        }

        .image-upload img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 6px;
        }

        /* Table */
        .table-wrapper {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 14px 16px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            background: #fafafa;
            font-weight: 600;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-secondary);
        }

        tbody tr:hover {
            background: #fafafa;
        }

        table img {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 4px;
        }

        /* Category/Attribute Cards */
        .items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        .item-card {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
        }

        .item-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .item-card h4 {
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .item-card .item-id {
            font-size: 11px;
            color: #999;
            background: #f5f5f5;
            padding: 2px 8px;
            border-radius: 10px;
        }

        .item-card p {
            color: var(--text-secondary);
            font-size: 13px;
            margin-bottom: 12px;
        }

        .item-meta {
            display: flex;
            gap: 16px;
            font-size: 12px;
            color: #999;
            margin-bottom: 16px;
        }

        .item-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 16px;
            border-top: 1px solid #eee;
        }

        .item-actions {
            display: flex;
            gap: 8px;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .modal-overlay.active {
            display: flex;
            opacity: 1;
        }

        .modal {
            background: #fff;
            border-radius: 12px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            transform: translateY(-20px);
            transition: transform 0.3s ease;
        }

        .modal-overlay.active .modal {
            transform: translateY(0);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid var(--border-color);
        }

        .modal-header h3 {
            font-size: 18px;
        }

        .modal-close {
            font-size: 20px;
            color: var(--text-muted);
            cursor: pointer;
            background: none;
            border: none;
        }

        .modal-body {
            padding: 24px;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            padding: 20px 24px;
            border-top: 1px solid var(--border-color);
        }

        /* Toast */
        .toast-container {
            position: fixed;
            top: 24px;
            right: 24px;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .toast {
            padding: 14px 20px;
            background: var(--primary-color);
            color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            animation: slideIn 0.3s ease;
        }

        .toast.success {
            background: var(--success-color);
        }

        .toast.error {
            background: var(--danger-color);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-muted);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-muted);
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        /* Attributes Fields */
        .attributes-section {
            margin-bottom: 24px;
        }

        .attributes-section h4 {
            margin-bottom: 16px;
            font-size: 16px;
        }

        .attribute-item {
            margin-bottom: 16px;
        }

        .attribute-item label {
            display: block;
            margin-bottom: 6px;
            font-size: 13px;
            color: var(--text-secondary);
        }

        /* Help Text */
        .help-box {
            background: #f0f7ff;
            border-left: 4px solid var(--accent-color);
            padding: 16px;
            margin-bottom: 20px;
            font-size: 13px;
            color: var(--text-secondary);
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .sidebar {
                width: 70px;
            }
            
            .sidebar-header h1,
            .sidebar-header p,
            .nav-item span:last-child {
                display: none;
            }
            
            .nav-item {
                justify-content: center;
                padding: 14px;
            }
            
            .main-content {
                margin-left: 70px;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                width: 100%;
                height: auto;
                flex-direction: row;
                justify-content: space-around;
                padding: 0;
            }
            
            .sidebar-header,
            .sidebar-footer {
                display: none;
            }
            
            .sidebar-nav {
                display: flex;
                flex-direction: row;
                padding: 0;
                width: 100%;
                justify-content: space-around;
            }
            
            .nav-item {
                flex-direction: column;
                gap: 4px;
                padding: 8px;
                font-size: 10px;
                border-left: none;
                border-top: 3px solid transparent;
            }
            
            .nav-item.active {
                border-left: none;
                border-top-color: #fff;
            }
            
            .main-content {
                margin-left: 0;
                margin-bottom: 70px;
                padding: 16px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Header Actions */
        .header-actions {
            display: flex;
            gap: 12px;
            margin-top: 16px;
            flex-wrap: wrap;
        }

        .header-actions input,
        .header-actions select {
            padding: 10px 16px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 14px;
        }

        .header-actions input {
            min-width: 200px;
        }

        /* Badges */
        .badge {
            display: inline-block;
            padding: 4px 10px;
            background: var(--bg-color);
            border-radius: 20px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .badge.active {
            background: #d4edda;
            color: #155724;
        }

        .badge.inactive {
            background: #f8d7da;
            color: #721c24;
        }

        /* Quick Add Button */
        .quick-add {
            background: #f8f9fa;
            border: 2px dashed #ddd;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 10px;
            color: #999;
        }

        .quick-add:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .quick-add-icon {
            font-size: 2rem;
        }

        /* Upload Progress */
        .upload-progress {
            margin-top: 20px;
            padding: 20px;
            background: var(--card-bg);
            border-radius: 10px;
            display: none;
        }

        .progress-bar {
            height: 8px;
            background: var(--bg-color);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: var(--accent-color);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .progress-text {
            font-size: 13px;
            color: var(--text-secondary);
        }
    
    /* Login Overlay Styles */
    .login-overlay {
        position: fixed;
        inset: 0;
        background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        backdrop-filter: blur(10px);
    }

    .login-overlay.active {
        display: flex;
    }

    .login-container {
        background: #ffffff;
        border-radius: 16px;
        padding: 48px 40px;
        width: 100%;
        max-width: 420px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        animation: slideUp 0.4s ease;
    }

    @keyframes slideUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .login-header {
        text-align: center;
        margin-bottom: 36px;
    }

    .login-header h1 {
        font-size: 28px;
        font-weight: 700;
        color: #1a1a1a;
        letter-spacing: 0.15em;
        margin-bottom: 8px;
    }

    .login-header p {
        font-size: 14px;
        color: #666;
        letter-spacing: 0.05em;
    }

    .login-form .form-group {
        margin-bottom: 24px;
    }

    .login-form .form-group label {
        display: block;
        margin-bottom: 8px;
        font-size: 13px;
        font-weight: 500;
        color: #333;
        letter-spacing: 0.02em;
    }

    .login-form .form-group input {
        width: 100%;
        padding: 14px 16px;
        border: 2px solid #e5e5e5;
        border-radius: 10px;
        font-size: 15px;
        transition: all 0.3s ease;
        background: #fafafa;
    }

    .login-form .form-group input:focus {
        outline: none;
        border-color: #1a1a1a;
        background: #fff;
        box-shadow: 0 0 0 4px rgba(26, 26, 26, 0.1);
    }

    .login-form .form-group input::placeholder {
        color: #999;
    }

    .login-error {
        background: #fff0f0;
        border: 1px solid #ffcdd2;
        color: #c62828;
        padding: 12px 16px;
        border-radius: 8px;
        font-size: 13px;
        margin-bottom: 20px;
        text-align: center;
    }

    .login-form .btn-block {
        width: 100%;
        padding: 16px;
        font-size: 15px;
        font-weight: 600;
        border-radius: 10px;
        margin-top: 12px;
        transition: all 0.3s ease;
        background: #1a1a1a;
        color: #fff;
        letter-spacing: 0.05em;
    }

    .login-form .btn-block:hover {
        background: #333;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .login-form .btn-block:active {
        transform: translateY(0);
    }

    .login-footer {
        text-align: center;
        margin-top: 32px;
        padding-top: 24px;
        border-top: 1px solid #eee;
    }

    .login-footer p {
        font-size: 12px;
        color: #999;
    }

    /* Admin User Info Styles */
    .admin-user-info {
        display: flex;
        align-items: center;
        gap: 16px;
        padding: 8px 16px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 8px;
    }

    .admin-user-info .username {
        font-size: 13px;
        color: rgba(255, 255, 255, 0.9);
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .admin-user-info .logout-btn {
        padding: 6px 14px;
        font-size: 12px;
        color: #fff;
        background: rgba(255, 255, 255, 0.15);
        border-radius: 6px;
        transition: all 0.2s ease;
        cursor: pointer;
        border: none;
    }

    .admin-user-info .logout-btn:hover {
        background: rgba(255, 255, 255, 0.25);
    }

    

</style>
</head>
<body>
    <div class="admin-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1>PHOTOGRAPHER</h1>
                <p>åå°ç®¡ç†</p>
            </div>
            <nav class="sidebar-nav">
                <div class="nav-item active" data-page="dashboard">
                    <span class="nav-icon">ğŸ“Š</span>
                    <span>æ•°æ®æ¦‚è§ˆ</span>
                </div>
                <div class="nav-item" data-page="photos">
                    <span class="nav-icon">ğŸ–¼ï¸</span>
                    <span>ä½œå“ç®¡ç†</span>
                </div>
                <div class="nav-item" data-page="upload">
                    <span class="nav-icon">â•</span>
                    <span>ä¸Šä¼ ä½œå“</span>
                </div>
                <div class="nav-item" data-page="categories">
                    <span class="nav-icon">ğŸ“</span>
                    <span>åˆ†ç±»ç®¡ç†</span>
                </div>
                <div class="nav-item" data-page="attributes">
                    <span class="nav-icon">ğŸ·ï¸</span>
                    <span>å±æ€§ç®¡ç†</span>
                </div>
                <div class="nav-item" data-page="about">
                    <span class="nav-icon">ğŸ‘¤</span>
                    <span>å…³äºæˆ‘</span>
                </div>
                <div class="nav-item" data-page="settings">
                    <span class="nav-icon">âš™ï¸</span>
                    <span>ç³»ç»Ÿè®¾ç½®</span>
                </div>
            </nav>
            <div class="sidebar-footer">
                <a href="index.html" target="_blank" class="view-site-btn">
                    ğŸ  æŸ¥çœ‹ç½‘ç«™
                </a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard Page -->
            <section id="page-dashboard" class="admin-page active">
                <div class="page-header">
                    <h2>æ•°æ®æ¦‚è§ˆ</h2>
                    <p>æ¬¢è¿ä½¿ç”¨åå°ç®¡ç†ç³»ç»Ÿ</p>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <span class="stat-icon">ğŸ–¼ï¸</span>
                        <div>
                            <span class="stat-number" id="total-photos">0</span>
                            <span class="stat-label">ä½œå“æ€»æ•°</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <span class="stat-icon">ğŸ“</span>
                        <div>
                            <span class="stat-number" id="total-categories">0</span>
                            <span class="stat-label">åˆ†ç±»æ•°é‡</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <span class="stat-icon">ğŸ·ï¸</span>
                        <div>
                            <span class="stat-number" id="total-attributes">0</span>
                            <span class="stat-label">å±æ€§æ•°é‡</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <span class="stat-icon">ğŸ‘ï¸</span>
                        <div>
                            <span class="stat-number" id="active-photos">0</span>
                            <span class="stat-label">å·²å‘å¸ƒä½œå“</span>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <h3>æœ€è¿‘æ·»åŠ çš„ä½œå“</h3>
                    <div id="recent-photos" class="loading">åŠ è½½ä¸­...</div>
                </div>
            </section>

            <!-- Photos Page -->
            <section id="page-photos" class="admin-page">
                <div class="page-header">
                    <h2>ä½œå“ç®¡ç†</h2>
                    <p>ç®¡ç†æ‚¨çš„æ‘„å½±ä½œå“</p>
                </div>
                <div class="header-actions">
                    <input type="text" id="search-photos" placeholder="æœç´¢ä½œå“...">
                    <select id="filter-category">
                        <option value="">å…¨éƒ¨åˆ†ç±»</option>
                    </select>
                </div>
                <div class="card">
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>ç¼©ç•¥å›¾</th>
                                    <th>æ ‡é¢˜</th>
                                    <th>åˆ†ç±»</th>
                                    <th>å¹´ä»½</th>
                                    <th>çŠ¶æ€</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="photos-list">
                                <tr><td colspan="6" class="loading">åŠ è½½ä¸­...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Upload Page -->
            <section id="page-upload" class="admin-page">
                <div class="page-header">
                    <h2>ä¸Šä¼ ä½œå“</h2>
                    <p>æ·»åŠ æ–°çš„æ‘„å½±ä½œå“</p>
                </div>
                <div class="card">
                    <form id="upload-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="photo-title">ä½œå“æ ‡é¢˜ *</label>
                                <input type="text" id="photo-title" required placeholder="è¾“å…¥ä½œå“æ ‡é¢˜">
                            </div>
                            <div class="form-group">
                                <label for="photo-category">åˆ†ç±» *</label>
                                <select id="photo-category" required>
                                    <option value="">é€‰æ‹©åˆ†ç±»</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="photo-year">æ‹æ‘„å¹´ä»½</label>
                                <input type="number" id="photo-year" value="2026" min="1900" max="2100">
                            </div>
                            <div class="form-group">
                                <label for="photo-sort">æ’åºåºå·</label>
                                <input type="number" id="photo-sort" value="0" min="0">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="photo-description">ä½œå“æè¿°</label>
                            <textarea id="photo-description" rows="3" placeholder="æè¿°æ‚¨çš„ä½œå“..."></textarea>
                        </div>
                        
                        <div class="attributes-section">
                            <h4>ä½œå“å±æ€§</h4>
                            <div id="upload-attributes">
                                <div class="loading">åŠ è½½å±æ€§ä¸­...</div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>é«˜æ¸…åŸå›¾ *</label>
                            <div class="image-upload" id="full-upload">
                                <input type="file" id="photo-full" accept="image/*" required>
                                <span>ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ å›¾ç‰‡</span>
                            </div>
                            <small style="color: #999;">ä¸Šä¼ åç³»ç»Ÿå°†è‡ªåŠ¨ç”Ÿæˆç¼©ç•¥å›¾</small>
                        </div>
                        
                        <div style="display: flex; gap: 12px;">
                            <button type="submit" class="btn btn-primary">ä¸Šä¼ ä½œå“</button>
                            <button type="reset" class="btn btn-secondary">é‡ç½®</button>
                        </div>
                    </form>
                    <div class="upload-progress" id="upload-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
                        </div>
                        <span class="progress-text" id="progress-text">ä¸Šä¼ ä¸­...</span>
                    </div>
                </div>
            </section>

            <!-- Categories Page -->
            <section id="page-categories" class="admin-page">
                <div class="page-header">
                    <h2>åˆ†ç±»ç®¡ç†</h2>
                    <p>ç®¡ç†æ‚¨çš„æ‘„å½±ä½œå“åˆ†ç±»</p>
                </div>
                <div class="header-actions">
                    <button class="btn btn-primary" onclick="openCategoryModal()">â• æ·»åŠ åˆ†ç±»</button>
                </div>
                <div class="card">
                    <div id="categories-list" class="items-grid">
                        <div class="loading">åŠ è½½ä¸­...</div>
                    </div>
                </div>
            </section>

            <!-- Attributes Page -->
            <section id="page-attributes" class="admin-page">
                <div class="page-header">
                    <h2>å±æ€§ç®¡ç†</h2>
                    <p>ç®¡ç†ä½œå“çš„è‡ªå®šä¹‰å±æ€§</p>
                </div>
                <div class="help-box">
                    ğŸ’¡ å±æ€§ç”¨äºæè¿°ä½œå“çš„å…·ä½“ç‰¹å¾ï¼Œå¦‚å°ºå¯¸ã€åº•ç‰‡è§„æ ¼ã€å·¥è‰ºè¯´æ˜ç­‰ã€‚æ¯ä¸ªå±æ€§éƒ½å¯ä»¥åœ¨ä¸Šä¼ ä½œå“æ—¶å¡«å†™ç›¸åº”çš„å€¼ã€‚
                </div>
                <div class="header-actions">
                    <button class="btn btn-primary" onclick="openAttributeModal()">â• æ·»åŠ å±æ€§</button>
                </div>
                <div class="card">
                    <div id="attributes-list" class="items-grid">
                        <div class="loading">åŠ è½½ä¸­...</div>
                    </div>
                </div>
            </section>

            <!-- About Me Page -->
            <section id="page-about" class="admin-page">
                <div class="page-header">
                    <h2>å…³äºæˆ‘</h2>
                    <p>ç¼–è¾‘æ‚¨çš„ä¸ªäººç®€ä»‹</p>
                </div>
                <div class="card">
                    <form id="about-form">
                        <div class="form-group">
                            <label for="about-name">æ‚¨çš„å§“å</label>
                            <input type="text" id="about-name" placeholder="è¾“å…¥æ‚¨çš„å§“å">
                        </div>
                        <div class="form-group">
                            <label for="about-title">èŒç§°/å¤´è¡”</label>
                            <input type="text" id="about-title" placeholder="ä¾‹å¦‚ï¼šæ‘„å½±å¸ˆã€è‰ºæœ¯å®¶ç­‰">
                        </div>
                        <div class="form-group">
                            <label for="about-bio">ä¸ªäººç®€ä»‹</label>
                            <textarea id="about-bio" rows="6" placeholder="ä»‹ç»æ‚¨çš„æ‘„å½±ç†å¿µã€ç»å†ç­‰..."></textarea>
                        </div>
                        <div class="form-group">
                            <label for="about-contact">è”ç³»æ–¹å¼</label>
                            <textarea id="about-contact" rows="3" placeholder="é‚®ç®±ã€ç”µè¯ç­‰..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>å¤´åƒç…§ç‰‡</label>
                            <div class="image-upload" id="avatar-upload" style="width: 200px; height: 200px;">
                                <input type="file" id="about-avatar" accept="image/*">
                                <span>ç‚¹å‡»ä¸Šä¼ å¤´åƒ</span>
                            </div>
                            <small style="color: #999;">å»ºè®®å°ºå¯¸: 400x400 åƒç´ </small>
                        </div>
                        
                        <div class="form-section" style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee;">
                            <h3 style="margin-bottom: 20px;">ç¤¾äº¤åª’ä½“äºŒç»´ç </h3>
                            <p style="color: #666; margin-bottom: 20px;">ä¸Šä¼ å°çº¢ä¹¦å’ŒBç«™çš„äºŒç»´ç å›¾ç‰‡</p>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>å°çº¢ä¹¦äºŒç»´ç </label>
                                    <div class="image-upload" id="xiaohongshu-upload" style="width: 180px; height: 180px;">
                                        <input type="file" id="about-xiaohongshu" accept="image/*">
                                        <span>ä¸Šä¼ äºŒç»´ç </span>
                                    </div>
                                    <small style="color: #999;">å»ºè®®å°ºå¯¸: 300x300 åƒç´ </small>
                                </div>
                                <div class="form-group">
                                    <label>Bç«™äºŒç»´ç </label>
                                    <div class="image-upload" id="bilibili-upload" style="width: 180px; height: 180px;">
                                        <input type="file" id="about-bilibili" accept="image/*">
                                        <span>ä¸Šä¼ äºŒç»´ç </span>
                                    </div>
                                    <small style="color: #999;">å»ºè®®å°ºå¯¸: 300x300 åƒç´ </small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-actions" style="margin-top: 30px;">
                            <button type="submit" class="btn btn-primary">ä¿å­˜ä¿®æ”¹</button>
                        </div>
                    </form>
                </div>
            </section>

            <!-- Settings Page -->
            <section id="page-settings" class="admin-page">
                <div class="page-header">
                    <h2>ç³»ç»Ÿè®¾ç½®</h2>
                    <p>é…ç½®ç³»ç»Ÿå‚æ•°</p>
                </div>
                <div class="card">
                    <h3>Supabase é…ç½®</h3>
                    <div class="form-group">
                        <label>é¡¹ç›® URL</label>
                        <input type="text" value="https://gtgcqywkekfofdcbkaek.supabase.co" readonly>
                    </div>
                    <div class="form-group">
                        <label>API å¯†é’¥</label>
                        <input type="password" value="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" readonly>
                        <small style="color: #999;">å¯†é’¥å·²é…ç½®ï¼Œå¦‚éœ€ä¿®æ”¹è¯·è”ç³»ç®¡ç†å‘˜</small>
                    </div>
                </div>
                <div class="card">
                    <h3>ğŸï¸ é¦–é¡µ Banner è½®æ’­å›¾</h3>
                    <p style="color: #666; margin-bottom: 20px;">ç®¡ç†é¦–é¡µé¡¶éƒ¨çš„è½®æ’­å›¾ç‰‡</p>

                    <div id="banner-list" class="banner-list">
                        <div class="loading">åŠ è½½ä¸­...</div>
                    </div>

                    <button class="btn btn-primary" onclick="addBannerItem()" style="margin-top: 20px;">
                        â• æ·»åŠ  Banner å›¾ç‰‡
                    </button>
                </div>
                <div class="card">
                    <h3>æ•°æ®ç®¡ç†</h3>
                    <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                        <button class="btn btn-secondary" onclick="exportData()">ğŸ“¥ å¯¼å‡ºæ•°æ®</button>
                        <button class="btn btn-secondary" onclick="importData()">ğŸ“¤ å¯¼å…¥æ•°æ®</button>
                        <button class="btn btn-danger" onclick="clearData()">ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰æ•°æ®</button>
                    </div>
                </div>
            </section>

    <!-- Account Settings Page -->
    <section id="page-account" class="admin-page">
        <div class="page-header">
            <h2>è´¦æˆ·è®¾ç½®</h2>
            <p>ç®¡ç†æ‚¨çš„è´¦æˆ·ä¿¡æ¯</p>
        </div>

        <div class="card">
            <h3>å½“å‰è´¦æˆ·ä¿¡æ¯</h3>
            <div class="current-info">
                <div class="label">ç”¨æˆ·å</div>
                <div class="value" id="current-username">åŠ è½½ä¸­...</div>
            </div>
            <div class="current-info">
                <div class="label">è´¦æˆ·è§’è‰²</div>
                <div class="value">ç®¡ç†å‘˜</div>
            </div>
        </div>

        <div class="card">
            <div class="account-tabs">
                <button class="account-tab active" data-tab="username">ä¿®æ”¹ç”¨æˆ·å</button>
                <button class="account-tab" data-tab="password">ä¿®æ”¹å¯†ç </button>
            </div>

            <!-- Username Tab -->
            <div id="tab-username" class="tab-content active">
                <form id="username-form">
                    <div class="form-group">
                        <label for="current-username-input">å½“å‰ç”¨æˆ·å</label>
                        <input type="text" id="current-username-input" readonly>
                    </div>
                    <div class="form-group">
                        <label for="new-username">æ–°ç”¨æˆ·å *</label>
                        <input type="text" id="new-username" required minlength="3" maxlength="20" placeholder="è¾“å…¥æ–°ç”¨æˆ·åï¼ˆ3-20ä¸ªå­—ç¬¦ï¼‰">
                    </div>
                    <div class="form-group">
                        <label for="confirm-username">ç¡®è®¤æ–°ç”¨æˆ·å *</label>
                        <input type="text" id="confirm-username" required placeholder="å†æ¬¡è¾“å…¥æ–°ç”¨æˆ·å">
                    </div>
                    <button type="submit" class="btn btn-primary">æ›´æ–°ç”¨æˆ·å</button>
                </form>
            </div>

            <!-- Password Tab -->
            <div id="tab-password" class="tab-content">
                <form id="password-form">
                    <div class="form-group">
                        <label for="current-password">å½“å‰å¯†ç  *</label>
                        <input type="password" id="current-password" required placeholder="è¾“å…¥å½“å‰å¯†ç ">
                    </div>
                    <div class="form-group">
                        <label for="new-password">æ–°å¯†ç  *</label>
                        <input type="password" id="new-password" required minlength="6" placeholder="è¾“å…¥æ–°å¯†ç ï¼ˆè‡³å°‘6ä¸ªå­—ç¬¦ï¼‰">
                        <div class="password-strength">
                            <div class="password-strength-bar" id="password-strength-bar"></div>
                        </div>
                        <p class="password-hint">å¯†ç å¼ºåº¦æŒ‡ç¤ºå™¨</p>
                    </div>
                    <div class="form-group">
                        <label for="confirm-new-password">ç¡®è®¤æ–°å¯†ç  *</label>
                        <input type="password" id="confirm-new-password" required placeholder="å†æ¬¡è¾“å…¥æ–°å¯†ç ">
                    </div>
                    <button type="submit" class="btn btn-primary">æ›´æ–°å¯†ç </button>
                </form>
            </div>
        </div>
    </section>
        </main>
    </div>

    <!-- Category Modal -->
    <div class="modal-overlay" id="category-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 id="category-modal-title">æ·»åŠ åˆ†ç±»</h3>
                <button class="modal-close" onclick="closeCategoryModal()">âœ•</button>
            </div>
            <form id="category-form">
                <div class="modal-body">
                    <input type="hidden" id="category-id">
                    <div class="form-group">
                        <label for="category-name">åˆ†ç±»åç§° *</label>
                        <input type="text" id="category-name" required placeholder="ä¾‹å¦‚ï¼šæ•°ç ã€èƒ¶ç‰‡ã€æ¹¿ç‰ˆ">
                    </div>
                    <div class="form-group">
                        <label for="category-description">åˆ†ç±»æè¿°</label>
                        <textarea id="category-description" rows="3" placeholder="æè¿°è¿™ä¸ªåˆ†ç±»..."></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary">ä¿å­˜</button>
                    <button type="button" class="btn btn-secondary" onclick="closeCategoryModal()">å–æ¶ˆ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Attribute Modal -->
    <div class="modal-overlay" id="attribute-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 id="attribute-modal-title">æ·»åŠ å±æ€§</h3>
                <button class="modal-close" onclick="closeAttributeModal()">âœ•</button>
            </div>
            <form id="attribute-form">
                <div class="modal-body">
                    <input type="hidden" id="attribute-id">
                    <div class="form-group">
                        <label for="attribute-name">å±æ€§åç§° *</label>
                        <input type="text" id="attribute-name" required placeholder="ä¾‹å¦‚ï¼šä½œå“å°ºå¯¸ã€åº•ç‰‡å°ºå¯¸">
                    </div>
                    <div class="form-group">
                        <label for="attribute-description">å±æ€§æè¿°</label>
                        <textarea id="attribute-description" rows="2" placeholder="æè¿°è¿™ä¸ªå±æ€§çš„ç”¨é€”..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="attribute-unit">å•ä½ï¼ˆå¯é€‰ï¼‰</label>
                        <input type="text" id="attribute-unit" placeholder="ä¾‹å¦‚ï¼šcmã€è‹±å¯¸ã€mmç­‰">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary">ä¿å­˜</button>
                    <button type="button" class="btn btn-secondary" onclick="closeAttributeModal()">å–æ¶ˆ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Photo Edit Modal -->
    <div class="modal-overlay" id="photo-modal">
        <div class="modal" style="max-width: 700px;">
            <div class="modal-header">
                <h3 id="photo-modal-title">ç¼–è¾‘ä½œå“</h3>
                <button class="modal-close" onclick="closePhotoModal()">âœ•</button>
            </div>
            <form id="photo-form">
                <div class="modal-body">
                    <input type="hidden" id="photo-id">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="photo-title-edit">ä½œå“æ ‡é¢˜ *</label>
                            <input type="text" id="photo-title-edit" required placeholder="è¾“å…¥ä½œå“æ ‡é¢˜">
                        </div>
                        <div class="form-group">
                            <label for="photo-category-edit">åˆ†ç±» *</label>
                            <select id="photo-category-edit" required>
                                <option value="">é€‰æ‹©åˆ†ç±»</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="photo-year-edit">æ‹æ‘„å¹´ä»½</label>
                            <input type="number" id="photo-year-edit" value="2026" min="1900" max="2100">
                        </div>
                        <div class="form-group">
                            <label for="photo-sort-edit">æ’åºåºå·</label>
                            <input type="number" id="photo-sort-edit" value="0" min="0">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="photo-description-edit">ä½œå“æè¿°</label>
                        <textarea id="photo-description-edit" rows="3" placeholder="æè¿°æ‚¨çš„ä½œå“..."></textarea>
                    </div>
                    
                    <div class="attributes-section">
                        <h4>ä½œå“å±æ€§</h4>
                        <div id="edit-attributes">
                            <div class="loading">åŠ è½½å±æ€§ä¸­...</div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>çŠ¶æ€</label>
                        <select id="photo-active-edit">
                            <option value="true">å·²å‘å¸ƒ</option>
                            <option value="false">è‰ç¨¿</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary">ä¿å­˜</button>
                    <button type="button" class="btn btn-secondary" onclick="closePhotoModal()">å–æ¶ˆ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Delete Confirm Modal -->
    <div class="modal-overlay" id="delete-modal">
        <div class="modal" style="max-width: 400px;">
            <div class="modal-header">
                <h3>ç¡®è®¤åˆ é™¤</h3>
                <button class="modal-close" onclick="closeDeleteModal()">âœ•</button>
            </div>
            <div class="modal-body">
                <p id="delete-message">ç¡®å®šè¦åˆ é™¤å—ï¼Ÿæ­¤æ“ä½œæ— æ³•æ’¤é”€ã€‚</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-danger" id="confirm-delete-btn">åˆ é™¤</button>
                <button class="btn btn-secondary" onclick="closeDeleteModal()">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <!-- Account Settings Page -->
    <section id="page-account" class="admin-page">
        <div class="page-header">
            <h2>è´¦æˆ·è®¾ç½®</h2>
            <p>ç®¡ç†æ‚¨çš„è´¦æˆ·ä¿¡æ¯</p>
        </div>

        <div class="card">
            <h3>å½“å‰è´¦æˆ·ä¿¡æ¯</h3>
            <div class="current-info">
                <div class="label">ç”¨æˆ·å</div>
                <div class="value" id="current-username">åŠ è½½ä¸­...</div>
            </div>
            <div class="current-info">
                <div class="label">è´¦æˆ·è§’è‰²</div>
                <div class="value">ç®¡ç†å‘˜</div>
            </div>
        </div>

        <div class="card">
            <div class="account-tabs">
                <button class="account-tab active" data-tab="username">ä¿®æ”¹ç”¨æˆ·å</button>
                <button class="account-tab" data-tab="password">ä¿®æ”¹å¯†ç </button>
            </div>

            <!-- Username Tab -->
            <div id="tab-username" class="tab-content active">
                <form id="username-form">
                    <div class="form-group">
                        <label for="current-username-input">å½“å‰ç”¨æˆ·å</label>
                        <input type="text" id="current-username-input" readonly>
                    </div>
                    <div class="form-group">
                        <label for="new-username">æ–°ç”¨æˆ·å *</label>
                        <input type="text" id="new-username" required minlength="3" maxlength="20" placeholder="è¾“å…¥æ–°ç”¨æˆ·åï¼ˆ3-20ä¸ªå­—ç¬¦ï¼‰">
                    </div>
                    <div class="form-group">
                        <label for="confirm-username">ç¡®è®¤æ–°ç”¨æˆ·å *</label>
                        <input type="text" id="confirm-username" required placeholder="å†æ¬¡è¾“å…¥æ–°ç”¨æˆ·å">
                    </div>
                    <button type="submit" class="btn btn-primary">æ›´æ–°ç”¨æˆ·å</button>
                </form>
            </div>

            <!-- Password Tab -->
            <div id="tab-password" class="tab-content">
                <form id="password-form">
                    <div class="form-group">
                        <label for="current-password">å½“å‰å¯†ç  *</label>
                        <input type="password" id="current-password" required placeholder="è¾“å…¥å½“å‰å¯†ç ">
                    </div>
                    <div class="form-group">
                        <label for="new-password">æ–°å¯†ç  *</label>
                        <input type="password" id="new-password" required minlength="6" placeholder="è¾“å…¥æ–°å¯†ç ï¼ˆè‡³å°‘6ä¸ªå­—ç¬¦ï¼‰">
                        <div class="password-strength">
                            <div class="password-strength-bar" id="password-strength-bar"></div>
                        </div>
                        <p class="password-hint">å¯†ç å¼ºåº¦æŒ‡ç¤ºå™¨</p>
                    </div>
                    <div class="form-group">
                        <label for="confirm-new-password">ç¡®è®¤æ–°å¯†ç  *</label>
                        <input type="password" id="confirm-new-password" required placeholder="å†æ¬¡è¾“å…¥æ–°å¯†ç ">
                    </div>
                    <button type="submit" class="btn btn-primary">æ›´æ–°å¯†ç </button>
                </form>
            </div>
        </div>
    </section>

    <!-- Toast Container -->
    <div class="toast-container" id="toast-container"></div>

    <!-- Login Overlay -->
    <div id="login-overlay" class="login-overlay" style="display: none;">
        <div class="login-container">
            <div class="login-header">
                <h1>PHOTOGRAPHER</h1>
                <p>åå°ç®¡ç†ç³»ç»Ÿ</p>
            </div>
            <form id="login-form" class="login-form">
                <div class="form-group">
                    <label for="login-username">ç”¨æˆ·å</label>
                    <input type="text" id="login-username" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" required>
                </div>
                <div class="form-group">
                    <label for="login-password">å¯†ç </label>
                    <input type="password" id="login-password" placeholder="è¯·è¾“å…¥å¯†ç " required>
                </div>
                <div id="login-error" class="login-error" style="display: none;"></div>
                <button type="submit" class="btn btn-primary btn-block">ç™»å½•</button>
            </form>
            <div class="login-footer">
                <p>Â© 2026 PHOTOGRAPHER</p>
            </div>
        </div>
    </div>

    <script src="supabase.js">

    

    async function loadCurrentUsername() {
        try {
            // ä» localStorage ç›´æ¥è¯»å–ç”¨æˆ·é…ç½®
            const userConfig = localStorage.getItem('admin_user_config');
            if (userConfig) {
                const config = JSON.parse(userConfig);
                document.getElementById('current-username').textContent = config.username;
                document.getElementById('current-username-input').value = config.username;
            } else {
                // é»˜è®¤ç”¨æˆ·å
                document.getElementById('current-username').textContent = 'admin';
                document.getElementById('current-username-input').value = 'admin';
            }
        } catch (error) {
            console.error('[Account] åŠ è½½ç”¨æˆ·åå¤±è´¥:', error);
        }
    }

     else if (strength <= 4) {
            strengthBar.classList.add('medium');
        } else {
            strengthBar.classList.add('strong');
        }
    }

    

        if (newUsername !== confirmUsername) {
            showToast('ä¸¤æ¬¡è¾“å…¥çš„ç”¨æˆ·åä¸ä¸€è‡´', 'error');
            return;
        }

        // è·å–å½“å‰ç”¨æˆ·å
        const userConfig = localStorage.getItem('admin_user_config');
        const currentConfig = userConfig ? JSON.parse(userConfig) : { username: 'admin' };
        
        if (currentConfig.username === newUsername) {
            showToast('æ–°ç”¨æˆ·åä¸å½“å‰ç”¨æˆ·åç›¸åŒ', 'error');
            return;
        }

        try {
            // ç›´æ¥æ›´æ–° localStorage ä¸­çš„ç”¨æˆ·é…ç½®
            const newConfig = {
                ...currentConfig,
                username: newUsername
            };
            localStorage.setItem('admin_user_config', JSON.stringify(newConfig));

            showToast('ç”¨æˆ·åå·²æˆåŠŸæ›´æ–°ï¼', 'success');

            // é‡ç½®è¡¨å•
            document.getElementById('username-form').reset();

            // æ›´æ–°æ˜¾ç¤ºçš„ç”¨æˆ·å
            loadCurrentUsername();
        } catch (error) {
            console.error('[Account] æ›´æ–°ç”¨æˆ·åå¤±è´¥:', error);
            showToast('æ›´æ–°å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', 'error');
        }
    }

    

        if (!newPassword || newPassword.length < 6) {
            showToast('æ–°å¯†ç è‡³å°‘éœ€è¦6ä¸ªå­—ç¬¦', 'error');
            return;
        }

        if (newPassword !== confirmNewPassword) {
            showToast('ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´', 'error');
            return;
        }

        // è·å–å½“å‰å¯†ç é…ç½®
        const userConfig = localStorage.getItem('admin_user_config');
        const currentConfig = userConfig ? JSON.parse(userConfig) : { password_hash: '' };
        
        // è®¡ç®—å½“å‰è¾“å…¥å¯†ç çš„å“ˆå¸Œ
        const inputHash = window.supabase.hashPassword(currentPassword);
        
        // éªŒè¯å½“å‰å¯†ç 
        if (currentConfig.password_hash && inputHash !== currentConfig.password_hash) {
            showToast('å½“å‰å¯†ç ä¸æ­£ç¡®', 'error');
            return;
        }

        // ä¸èƒ½ä¸å½“å‰å¯†ç ç›¸åŒ
        if (currentConfig.password_hash && inputHash === window.supabase.hashPassword(newPassword)) {
            showToast('æ–°å¯†ç ä¸èƒ½ä¸å½“å‰å¯†ç ç›¸åŒ', 'error');
            return;
        }

        try {
            // è®¡ç®—æ–°å¯†ç çš„å“ˆå¸Œ
            const newPasswordHash = window.supabase.hashPassword(newPassword);
            
            // æ›´æ–° localStorage ä¸­çš„ç”¨æˆ·é…ç½®
            const newConfig = {
                ...currentConfig,
                password_hash: newPasswordHash
            };
            localStorage.setItem('admin_user_config', JSON.stringify(newConfig));

            showToast('å¯†ç å·²æˆåŠŸæ›´æ–°ï¼', 'success');

            // é‡ç½®è¡¨å•
            document.getElementById('password-form').reset();
            updatePasswordStrength('');
        } catch (error) {
            console.error('[Account] æ›´æ–°å¯†ç å¤±è´¥:', error);
            showToast('æ›´æ–°å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', 'error');
        }
    }
</script>
    <script>
        // Global State
        let currentPage = 'dashboard';
        let categories = [];
        let attributes = [];
        let deleteTarget = { type: '', id: '', message: '' };
        let photoCategoryCounts = {};
        let isLoggedIn = false;

        // ============ Authentication ============

        async function checkAuth() {
            console.log('[Auth] æ£€æŸ¥ç™»å½•çŠ¶æ€...');
            
            try {
                const { authenticated, session } = await window.supabase.checkSession();
                
                if (authenticated) {
                    console.log('[Auth] å·²ç™»å½•:', session.username);
                    return { authenticated: true, session };
                } else {
                    console.log('[Auth] æœªç™»å½•');
                    return { authenticated: false, session: null };
                }
            } catch (error) {
                console.error('[Auth] æ£€æŸ¥ç™»å½•çŠ¶æ€å¤±è´¥:', error);
                // æ£€æŸ¥æ˜¯å¦æœ‰è‡ªå®šä¹‰é…ç½®ï¼Œå¦‚æœæœ‰åˆ™å…è®¸è®¿é—®
                const userConfig = localStorage.getItem('admin_user_config');
                if (userConfig) {
                    console.log('[Auth] æ£€æµ‹åˆ°è‡ªå®šä¹‰é…ç½®ï¼Œå…è®¸è®¿é—®');
                    const config = JSON.parse(userConfig);
                    return { authenticated: true, session: { username: config.username } };
                }
                return { authenticated: false, session: null };
            }
        }

        async function doLogin(username, password) {
            console.log('[Auth] å°è¯•ç™»å½•:', username);
            
            // æ£€æŸ¥æ˜¯å¦æœ‰è‡ªå®šä¹‰é…ç½®
            const userConfig = localStorage.getItem('admin_user_config');
            const config = userConfig ? JSON.parse(userConfig) : null;
            
            // é»˜è®¤å¯†ç 
            const defaultHash = window.supabase.hashPassword('admin123');
            const inputHash = window.supabase.hashPassword(password);
            
            // éªŒè¯ç”¨æˆ·åå’Œå¯†ç 
            const validUsername = config ? config.username : 'admin';
            const validHash = config && config.password_hash ? config.password_hash : defaultHash;
            
            if (username === validUsername && inputHash === validHash) {
                console.log('[Auth] ç™»å½•æˆåŠŸ:', username);
                return { success: true, data: { username: validUsername } };
            } else {
                console.error('[Auth] ç™»å½•å¤±è´¥: ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯');
                return { success: false, error: 'ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯' };
            }
        }

        async function doLogout() {
            console.log('[Auth] é€€å‡ºç™»å½•');
            await window.supabase.logout();
        }

        function showLoginPage() {
            const overlay = document.getElementById('login-overlay');
            if (overlay) {
                overlay.style.display = 'flex';
            }
            
            // éšè—ç®¡ç†é¡µé¢
            const adminContainer = document.querySelector('.admin-container');
            if (adminContainer) {
                adminContainer.style.display = 'none';
            }
        }

        function hideLoginPage() {
            const overlay = document.getElementById('login-overlay');
            if (overlay) {
                overlay.style.display = 'none';
            }
            
            // æ˜¾ç¤ºç®¡ç†é¡µé¢
            const adminContainer = document.querySelector('.admin-container');
            if (adminContainer) {
                adminContainer.style.display = 'flex';
            }
        }

        function showAdminUserInfo(username) {
            const navbar = document.querySelector('.nav-container');
            if (!navbar) return;
            
            // ç§»é™¤å·²å­˜åœ¨çš„ç”¨æˆ·ä¿¡æ¯
            const existing = navbar.querySelector('.admin-user-info');
            if (existing) {
                existing.remove();
            }
            
            // åˆ›å»ºç”¨æˆ·ä¿¡æ¯å…ƒç´ 
            const userInfo = document.createElement('div');
            userInfo.className = 'admin-user-info';
            userInfo.innerHTML = `
                <span class="username">ğŸ‘¤ ${username}</span>
                <button class="logout-btn" onclick="handleLogout()">é€€å‡º</button>
            `;
            
            navbar.appendChild(userInfo);
        }

        async function handleLogin(event) {
            event.preventDefault();
            
            const username = document.getElementById('login-username').value.trim();
            const password = document.getElementById('login-password').value;
            const errorEl = document.getElementById('login-error');
            
            if (!username || !password) {
                errorEl.textContent = 'è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ';
                errorEl.style.display = 'block';
                return;
            }
            
            const result = await doLogin(username, password);
            
            if (result.success) {
                errorEl.style.display = 'none';
                hideLoginPage();
                showAdminUserInfo(result.data.username);
                showToast('ç™»å½•æˆåŠŸï¼Œæ¬¢è¿å›æ¥ï¼', 'success');
                
                // åˆå§‹åŒ–ç®¡ç†é¡µé¢
                await initAdminPage();
            } else {
                errorEl.textContent = result.error;
                errorEl.style.display = 'block';
            }
        }

        async function handleLogout() {
            await doLogout();
            
            // ç§»é™¤ç”¨æˆ·ä¿¡æ¯
            const userInfo = document.querySelector('.admin-user-info');
            if (userInfo) {
                userInfo.remove();
            }
            
            showLoginPage();
            showToast('å·²é€€å‡ºç™»å½•', 'success');
        }

        async function initAdminPage() {
            // åˆå§‹åŒ–è´¦æˆ·è®¾ç½®
            initAccountSettings();
            // åˆå§‹åŒ–å„ä¸ªæ¨¡å—
            initNavigation();
            await loadDashboard();
            await loadCategories();
            await loadAttributes();
            await loadPhotos();
            await loadCategoryDropdown();
            await loadAttributeFields();
            initUploadForm();
            initImagePreview();
            initCategoryForm();
            initAttributeForm();
            initPhotoForm();
            initAboutForm();
            initAvatarPreview();
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('[Init] åå°ç®¡ç†ç³»ç»Ÿå¯åŠ¨...');
            
            // åˆå§‹åŒ– Supabase
            await initSupabase();
            
            // æ£€æŸ¥ç™»å½•çŠ¶æ€
            const { authenticated, session } = await checkAuth();
            
            if (authenticated) {
                console.log('[Init] ç”¨æˆ·å·²ç™»å½•ï¼Œæ˜¾ç¤ºç®¡ç†é¡µé¢');
                hideLoginPage();
                showAdminUserInfo(session.username);
                await initAdminPage();
            } else {
                console.log('[Init] ç”¨æˆ·æœªç™»å½•ï¼Œæ˜¾ç¤ºç™»å½•é¡µé¢');
                showLoginPage();
            }
            
            // ç»‘å®šç™»å½•è¡¨å•
            const loginForm = document.getElementById('login-form');
            if (loginForm) {
                loginForm.addEventListener('submit', handleLogin);
            }
        });

        // Navigation
        function initNavigation() {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function() {
                    const page = this.dataset.page;
                    showPage(page);
                });
            });
        }

        function showPage(pageName) {
            // Update nav
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.toggle('active', item.dataset.page === pageName);
            });
            
            // Update page
            document.querySelectorAll('.admin-page').forEach(page => {
                page.classList.toggle('active', page.id === `page-${pageName}`);
            });
            
            currentPage = pageName;
            
            // Refresh data
            if (pageName === 'dashboard') loadDashboard();
            if (pageName === 'photos') loadPhotos();
            if (pageName === 'categories') loadCategories();
            if (pageName === 'attributes') loadAttributes();
            if (pageName === 'about') loadAbout();
        }

        // Dashboard
        async function loadDashboard() {
            const recentList = document.getElementById('recent-photos');
            recentList.innerHTML = '<div class="loading">åŠ è½½ä¸­...</div>';
            
            try {
                const { data: photos } = await window.supabase.select('photos');
                const { data: cats } = await window.supabase.getCategories();
                const { data: attrs } = await window.supabase.getAttributes();
                
                const activePhotos = photos?.filter(p => p.is_active) || [];
                const photoCount = photos?.length || 0;
                
                document.getElementById('total-photos').textContent = photoCount;
                document.getElementById('total-categories').textContent = cats?.length || 0;
                document.getElementById('total-attributes').textContent = attrs?.length || 0;
                document.getElementById('active-photos').textContent = activePhotos.length;
                
                // Photo counts by category
                photoCategoryCounts = {};
                photos?.forEach(p => {
                    photoCategoryCounts[p.category] = (photoCategoryCounts[p.category] || 0) + 1;
                });
                
                // Recent photos
                const recentPhotos = photos?.slice(-4).reverse() || [];
                
                if (recentPhotos.length === 0) {
                    recentList.innerHTML = '<div class="empty-state"><div class="empty-state-icon">ğŸ“·</div><p>æš‚æ— ä½œå“</p></div>';
                } else {
                    recentList.innerHTML = `
                        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 16px;">
                            ${recentPhotos.map(p => `
                                <div style="position: relative; border-radius: 8px; overflow: hidden; aspect-ratio: 1;">
                                    <img src="${p.thumbnail_url}" alt="${p.title}" style="width: 100%; height: 100%; object-fit: cover;">
                                    <div style="position: absolute; bottom: 0; left: 0; right: 0; padding: 8px; background: linear-gradient(transparent, rgba(0,0,0,0.7)); color: #fff; font-size: 12px;">
                                        ${p.title}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }
            } catch (error) {
                console.error('åŠ è½½ä»ªè¡¨ç›˜å¤±è´¥:', error);
                recentList.innerHTML = '<div class="empty-state"><div class="empty-state-icon">âš ï¸</div><p>åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•</p></div>';
                showToast('åŠ è½½æ•°æ®å¤±è´¥: ' + error.message, 'error');
            }
        }

        // Photos
        async function loadPhotos() {
            const tbody = document.getElementById('photos-list');
            tbody.innerHTML = '<tr><td colspan="6" class="loading">åŠ è½½ä¸­...</td></tr>';
            
            try {
                const searchTerm = document.getElementById('search-photos')?.value?.toLowerCase() || '';
                const filterCategory = document.getElementById('filter-category')?.value || '';
                
                const { data: photos } = await window.supabase.select('photos', {
                    order: { field: 'sort_order', ascending: true }
                });
                
                if (!photos?.length) {
                    tbody.innerHTML = `<tr><td colspan="6"><div class="empty-state"><div class="empty-state-icon">ğŸ“·</div><h3>æš‚æ— ä½œå“</h3><p>ç‚¹å‡»"ä¸Šä¼ ä½œå“"æ·»åŠ æ‚¨çš„ç¬¬ä¸€å¼ ä½œå“</p></div></td></tr>`;
                    return;
                }
                
                let filtered = photos;
                if (filterCategory) filtered = filtered.filter(p => p.category === filterCategory);
                if (searchTerm) filtered = filtered.filter(p => 
                    p.title.toLowerCase().includes(searchTerm) || 
                    p.description?.toLowerCase().includes(searchTerm)
                );
                
                tbody.innerHTML = filtered.map(p => `
                    <tr>
                        <td><img src="${p.thumbnail_url}" alt="${p.title}"></td>
                        <td><strong>${p.title}</strong><br><small style="color: #999">${p.description || ''}</small></td>
                        <td><span class="badge">${getCategoryName(p.category)}</span></td>
                        <td>${p.year || '-'}</td>
                        <td><span class="badge ${p.is_active ? 'active' : 'inactive'}">${p.is_active ? 'å·²å‘å¸ƒ' : 'è‰ç¨¿'}</span></td>
                        <td>
                            <div style="display: flex; gap: 8px;">
                                <button class="btn btn-sm btn-secondary" onclick="editPhoto('${p.id}')">ç¼–è¾‘</button>
                                <button class="btn btn-sm btn-danger" onclick="deletePhoto('${p.id}')">åˆ é™¤</button>
                            </div>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('åŠ è½½ä½œå“å¤±è´¥:', error);
                tbody.innerHTML = '<tr><td colspan="6" class="empty-state">åŠ è½½å¤±è´¥</td></tr>';
            }
        }

        function getCategoryName(id) {
            const cat = categories.find(c => c.id === id);
            return cat?.name || id;
        }

        async function loadCategoryDropdown() {
            const selects = [document.getElementById('filter-category'), document.getElementById('photo-category')];
            selects.forEach(select => {
                if (select) {
                    select.innerHTML = `<option value="">é€‰æ‹©åˆ†ç±»</option>` + 
                        categories.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
                }
            });
        }

        async function loadAttributeFields() {
            const container = document.getElementById('upload-attributes');
            if (!container) return;
            
            if (!attributes.length) {
                container.innerHTML = '<p style="color: #999; font-size: 13px;">æš‚æ— å±æ€§é…ç½®</p>';
                return;
            }
            
            container.innerHTML = attributes.map(attr => `
                <div class="attribute-item">
                    <label>${attr.name}${attr.unit ? ` (${attr.unit})` : ''}</label>
                    <input type="text" id="attr-${attr.id}" placeholder="è¾“å…¥${attr.name}">
                    ${attr.description ? `<small style="color: #999;">${attr.description}</small>` : ''}
                </div>
            `).join('');
        }

        // Upload Form
        function initUploadForm() {
            const form = document.getElementById('upload-form');
            if (!form) return;
            
            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const submitBtn = form.querySelector('button[type="submit"]');
                const progress = document.getElementById('upload-progress');
                const progressFill = document.getElementById('progress-fill');
                const progressText = document.getElementById('progress-text');
                
                submitBtn.disabled = true;
                submitBtn.textContent = 'ä¸Šä¼ ä¸­...';
                progress.style.display = 'block';
                progressFill.style.width = '10%';
                progressText.textContent = 'å¤„ç†å›¾ç‰‡...';
                
                try {
                    // Collect data
                    const attributesData = {};
                    attributes.forEach(attr => {
                        const value = document.getElementById(`attr-${attr.id}`)?.value;
                        if (value) attributesData[attr.id] = value;
                    });
                    
                    const photoData = {
                        title: document.getElementById('photo-title').value,
                        category: document.getElementById('photo-category').value,
                        year: parseInt(document.getElementById('photo-year').value) || new Date().getFullYear(),
                        sort_order: parseInt(document.getElementById('photo-sort').value) || 0,
                        description: document.getElementById('photo-description').value,
                        attributes: attributesData
                    };
                    
                    progressFill.style.width = '30%';
                    
                    // Upload full image
                    const fullInput = document.getElementById('photo-full');

                    if (!fullInput) {
                        throw new Error('æ–‡ä»¶ä¸Šä¼ ç»„ä»¶æœªæ‰¾åˆ°ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
                    }

                    if (!fullInput.files || fullInput.files.length === 0) {
                        throw new Error('è¯·é€‰æ‹©è¦ä¸Šä¼ çš„å›¾ç‰‡');
                    }

                    const file = fullInput.files[0];

                    // Upload full image to Supabase Storage
                    progressText.textContent = 'ä¸Šä¼ åŸå›¾...';
                    progressFill.style.width = '30%';
                    const uploadResult = await window.supabase.uploadAndCompress(file, 'photos', 'photo');

                    if (uploadResult.error) {
                        throw new Error('ä¸Šä¼ åŸå›¾å¤±è´¥: ' + uploadResult.error.message);
                    }

                    photoData.image_url = uploadResult.data.path;

                    // Generate and upload thumbnail to Supabase Storage
                    progressText.textContent = 'ç”Ÿæˆå¹¶ä¸Šä¼ ç¼©ç•¥å›¾...';
                    progressFill.style.width = '60%';
                    const thumbnailResult = await window.supabase.uploadThumbnail(file);

                    if (thumbnailResult.error) {
                        console.warn('[upload] ç¼©ç•¥å›¾ä¸Šä¼ å¤±è´¥ï¼Œä½¿ç”¨åŸå›¾ä½œä¸ºç¼©ç•¥å›¾');
                        photoData.thumbnail_url = uploadResult.data.path;
                    } else {
                        photoData.thumbnail_url = thumbnailResult.data.path;
                    }
                    
                    progressFill.style.width = '90%';
                    progressText.textContent = 'ä¿å­˜æ•°æ®...';
                    
                    // Save to database
                    const { error } = await window.supabase.insert('photos', photoData);
                    if (error) throw error;
                    
                    progressFill.style.width = '100%';
                    progressText.textContent = 'ä¸Šä¼ æˆåŠŸï¼';
                    
                    showToast('ä½œå“ä¸Šä¼ æˆåŠŸï¼', 'success');
                    
                    // Reset form
                    setTimeout(() => {
                        form.reset();
                        // é‡æ–°åˆå§‹åŒ–å›¾ç‰‡é¢„è§ˆåŠŸèƒ½
                        document.getElementById('full-upload').innerHTML = '<input type="file" id="photo-full" accept="image/*" required><span>ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ å›¾ç‰‡</span>';
                        initImagePreview(); // é‡æ–°ç»‘å®šäº‹ä»¶ç›‘å¬å™¨
                        progress.style.display = 'none';
                        submitBtn.disabled = false;
                        submitBtn.textContent = 'ä¸Šä¼ ä½œå“';
                        loadDashboard();
                        loadPhotos();
                    }, 1000);
                    
                } catch (error) {
                    console.error('ä¸Šä¼ å¤±è´¥:', error);
                    showToast('ä¸Šä¼ å¤±è´¥: ' + error.message, 'error');
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'ä¸Šä¼ ä½œå“';
                    progress.style.display = 'none';
                }
            });
        }

        // Generate thumbnail from image file
        function generateThumbnail(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.onload = function() {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        
                        // Set thumbnail size (max 400px)
                        const maxSize = 400;
                        let width = img.width;
                        let height = img.height;
                        
                        if (width > height) {
                            if (width > maxSize) {
                                height = Math.round(height * maxSize / width);
                                width = maxSize;
                            }
                        } else {
                            if (height > maxSize) {
                                width = Math.round(width * maxSize / height);
                                height = maxSize;
                            }
                        }
                        
                        canvas.width = width;
                        canvas.height = height;
                        
                        // Draw resized image
                        ctx.drawImage(img, 0, 0, width, height);
                        
                        // Return as data URL with quality 0.8
                        resolve(canvas.toDataURL('image/jpeg', 0.8));
                    };
                    img.onerror = reject;
                    img.src = e.target.result;
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        function initImagePreview() {
            const setupPreview = (inputId, containerId) => {
                const input = document.getElementById(inputId);
                const container = document.getElementById(containerId);
                if (!input || !container) return;
                
                // Store reference to file input before any modifications
                const fileInput = input;
                
                input.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            // Create image preview without destroying file input
                            const previewImg = document.createElement('img');
                            previewImg.src = e.target.result;
                            previewImg.alt = 'é¢„è§ˆ';
                            previewImg.style.cssText = 'position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; border-radius: 8px;';
                            
                            // Clear existing content and add preview
                            container.innerHTML = '';
                            container.appendChild(previewImg);
                            container.classList.add('has-image');
                            
                            // Re-append the file input (hidden but functional)
                            fileInput.style.display = 'none';
                            container.appendChild(fileInput);
                            
                            // Add a visible trigger button
                            const triggerBtn = document.createElement('button');
                            triggerBtn.type = 'button';
                            triggerBtn.innerHTML = 'æ›´æ¢å›¾ç‰‡';
                            triggerBtn.style.cssText = 'position: absolute; bottom: 8px; right: 8px; padding: 6px 12px; background: rgba(0,0,0,0.6); color: #fff; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;';
                            triggerBtn.onclick = function(e) {
                                e.stopPropagation();
                                fileInput.click();
                            };
                            container.appendChild(triggerBtn);
                        };
                        reader.readAsDataURL(file);
                    }
                });
            };
            
            setupPreview('photo-full', 'full-upload');
        }

        // Categories
        async function loadCategories() {
            const container = document.getElementById('categories-list');
            container.innerHTML = '<div class="loading">åŠ è½½ä¸­...</div>';
            
            try {
                const { data: cats, error } = await window.supabase.getCategories();
                if (error) throw error;
                categories = cats || [];
                
                if (categories.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state" style="grid-column: 1/-1;">
                            <div class="empty-state-icon">ğŸ“</div>
                            <h3>æš‚æ— åˆ†ç±»</h3>
                            <p>ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æ·»åŠ åˆ†ç±»</p>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = categories.map(cat => `
                    <div class="item-card">
                        <h4>${cat.name} <span class="item-id">${cat.id}</span></h4>
                        <p>${cat.description || 'æš‚æ— æè¿°'}</p>
                        <div class="item-footer">
                            <span class="badge">ğŸ“· ${photoCategoryCounts[cat.id] || 0} ä¸ªä½œå“</span>
                            <div class="item-actions">
                                <button class="btn btn-sm btn-secondary" onclick="editCategory('${cat.id}')">ç¼–è¾‘</button>
                                <button class="btn btn-sm btn-danger" onclick="confirmDeleteCategory('${cat.id}')">åˆ é™¤</button>
                            </div>
                        </div>
                    </div>
                `).join('') + `
                    <div class="quick-add" onclick="openCategoryModal()">
                        <div class="quick-add-icon">â•</div>
                        <div>æ·»åŠ åˆ†ç±»</div>
                    </div>
                `;
            } catch (error) {
                console.error('åŠ è½½åˆ†ç±»å¤±è´¥:', error);
                container.innerHTML = '<div class="empty-state">åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•</div>';
            }
        }

        function initCategoryForm() {
            document.getElementById('category-form').addEventListener('submit', async function(e) {
                e.preventDefault();
                
const id = document.getElementById('category-id').value;
                const data = {
                    name: document.getElementById('category-name').value,
                    description: document.getElementById('category-description').value
                };
                
                try {
                    let result;
                    if (id) {
                        result = await window.supabase.updateCategory(id, data);
                        showToast('åˆ†ç±»å·²æ›´æ–°', 'success');
                    } else {
                        result = await window.supabase.addCategory(data);
                        showToast('åˆ†ç±»å·²æ·»åŠ ', 'success');
                    }
                    
                    if (result.error) throw result.error;
                    
                    closeCategoryModal();
                    await loadCategories();
                    await loadCategoryDropdown();
                } catch (error) {
                    showToast('æ“ä½œå¤±è´¥: ' + error.message, 'error');
                }
            });
        }

        function openCategoryModal(cat = null) {
            document.getElementById('category-modal-title').textContent = cat ? 'ç¼–è¾‘åˆ†ç±»' : 'æ·»åŠ åˆ†ç±»';
            document.getElementById('category-form').reset();
            document.getElementById('category-id').value = cat?.id || '';
            if (cat) {
                document.getElementById('category-name').value = cat.name || '';
                document.getElementById('category-description').value = cat.description || '';
            }
            document.getElementById('category-modal').classList.add('active');
        }

        function editCategory(id) {
            const cat = categories.find(c => c.id === id);
            if (cat) openCategoryModal(cat);
        }

        function closeCategoryModal() {
            document.getElementById('category-modal').classList.remove('active');
        }

async function confirmDeleteCategory(id) {
            const cat = categories.find(c => c.id === id);
            if (!cat) return;
            
            const count = photoCategoryCounts[id] || 0;
            if (count > 0) {
                showToast(`æ— æ³•åˆ é™¤ï¼šè¯¥åˆ†ç±»ä¸‹æœ‰ ${count} ä¸ªä½œå“`, 'error');
                return;
            }
            
            deleteTarget = { type: 'category', id, message: `ç¡®å®šè¦åˆ é™¤åˆ†ç±»"${cat.name}"å—ï¼Ÿ` };
            document.getElementById('delete-message').textContent = deleteTarget.message;
            document.getElementById('delete-modal').classList.add('active');
        }

        // Attributes
        async function loadAttributes() {
            const container = document.getElementById('attributes-list');
            container.innerHTML = '<div class="loading">åŠ è½½ä¸­...</div>';
            
            try {
                const { data: attrs, error } = await window.supabase.getAttributes();
                if (error) throw error;
                attributes = attrs || [];
                
                if (attributes.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state" style="grid-column: 1/-1;">
                            <div class="empty-state-icon">ğŸ·ï¸</div>
                            <h3>æš‚æ— å±æ€§</h3>
                            <p>ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æ·»åŠ å±æ€§</p>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = attributes.map(attr => `
                    <div class="item-card">
                        <h4>${attr.name} <span class="item-id">${attr.id}</span></h4>
                        <p>${attr.description || 'æš‚æ— æè¿°'}</p>
                        <div class="item-meta">
                            ${attr.unit ? `<span>ğŸ“ å•ä½: ${attr.unit}</span>` : ''}
                        </div>
                        <div class="item-footer">
                            <span class="badge">ç”¨äºä½œå“è¯¦æƒ…</span>
                            <div class="item-actions">
                                <button class="btn btn-sm btn-secondary" onclick="editAttribute('${attr.id}')">ç¼–è¾‘</button>
                                <button class="btn btn-sm btn-danger" onclick="deleteAttribute('${attr.id}')">åˆ é™¤</button>
                            </div>
                        </div>
                    </div>
                `).join('') + `
                    <div class="quick-add" onclick="openAttributeModal()">
                        <div class="quick-add-icon">â•</div>
                        <div>æ·»åŠ å±æ€§</div>
                    </div>
                `;
            } catch (error) {
                console.error('åŠ è½½å±æ€§å¤±è´¥:', error);
                container.innerHTML = '<div class="empty-state">åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•</div>';
            }
        }

        function initAttributeForm() {
            document.getElementById('attribute-form').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const id = document.getElementById('attribute-id').value;
                const data = {
                    name: document.getElementById('attribute-name').value,
                    description: document.getElementById('attribute-description').value,
                    unit: document.getElementById('attribute-unit').value || ''
                };
                
                try {
                    let result;
                    if (id) {
                        result = await window.supabase.updateAttribute(id, data);
                        showToast('å±æ€§å·²æ›´æ–°', 'success');
                    } else {
                        result = await window.supabase.addAttribute(data);
                        showToast('å±æ€§å·²æ·»åŠ ', 'success');
                    }
                    
                    if (result.error) throw result.error;
                    
                    closeAttributeModal();
                    await loadAttributes();
                    await loadAttributeFields();
                } catch (error) {
                    showToast('æ“ä½œå¤±è´¥: ' + error.message, 'error');
                }
            });
        }

        function openAttributeModal(attr = null) {
            document.getElementById('attribute-modal-title').textContent = attr ? 'ç¼–è¾‘å±æ€§' : 'æ·»åŠ å±æ€§';
            document.getElementById('attribute-form').reset();
            document.getElementById('attribute-id').value = attr?.id || '';
            if (attr) {
                document.getElementById('attribute-name').value = attr.name || '';
                document.getElementById('attribute-description').value = attr.description || '';
                document.getElementById('attribute-unit').value = attr.unit || '';
            }
            document.getElementById('attribute-modal').classList.add('active');
        }

        function editAttribute(id) {
            const attr = attributes.find(a => a.id === id);
            if (attr) openAttributeModal(attr);
        }

        function closeAttributeModal() {
            document.getElementById('attribute-modal').classList.remove('active');
        }

        async function deleteAttribute(id) {
            const attr = attributes.find(a => a.id === id);
            if (!attr) return;
            
            deleteTarget = { type: 'attribute', id, message: `ç¡®å®šè¦åˆ é™¤å±æ€§"${attr.name}"å—ï¼Ÿ` };
            document.getElementById('delete-message').textContent = deleteTarget.message;
            document.getElementById('delete-modal').classList.add('active');
        }

        // Delete Confirmation
        document.getElementById('confirm-delete-btn').addEventListener('click', async function() {
            try {
                let result;
                if (deleteTarget.type === 'category') {
                    result = await window.supabase.deleteCategory(deleteTarget.id);
                } else if (deleteTarget.type === 'attribute') {
                    result = await window.supabase.deleteAttribute(deleteTarget.id);
                }
                
                if (result?.error) throw result.error;
                
                showToast('åˆ é™¤æˆåŠŸ', 'success');
                closeDeleteModal();
                
                await loadCategories();
                await loadAttributes();
                await loadAttributeFields();
                await loadDashboard();
            } catch (error) {
                showToast('åˆ é™¤å¤±è´¥: ' + error.message, 'error');
            }
        });

        function closeDeleteModal() {
            document.getElementById('delete-modal').classList.remove('active');
            deleteTarget = { type: '', id: '', message: '' };
        }

        // Photo operations
        async function editPhoto(id) {
            try {
                const { data: photo, error } = await window.supabase.getOne('photos', id);
                if (error) throw error;
                if (!photo) {
                    showToast('ä½œå“ä¸å­˜åœ¨', 'error');
                    return;
                }
                
                openPhotoModal(photo);
            } catch (error) {
                console.error('è·å–ä½œå“ä¿¡æ¯å¤±è´¥:', error);
                showToast('è·å–ä½œå“ä¿¡æ¯å¤±è´¥: ' + error.message, 'error');
            }
        }
        
        function openPhotoModal(photo = null) {
            document.getElementById('photo-modal-title').textContent = photo ? 'ç¼–è¾‘ä½œå“' : 'æ·»åŠ ä½œå“';
            document.getElementById('photo-form').reset();
            document.getElementById('photo-id').value = photo?.id || '';
            
            // åŠ è½½åˆ†ç±»ä¸‹æ‹‰åˆ—è¡¨
            loadPhotoCategoryDropdown(photo?.category);
            
            if (photo) {
                document.getElementById('photo-title-edit').value = photo.title || '';
                document.getElementById('photo-category-edit').value = photo.category || '';
                document.getElementById('photo-year-edit').value = photo.year || new Date().getFullYear();
                document.getElementById('photo-sort-edit').value = photo.sort_order || 0;
                document.getElementById('photo-description-edit').value = photo.description || '';
                document.getElementById('photo-active-edit').value = photo.is_active ? 'true' : 'false';
            }
            
            // åŠ è½½å±æ€§å­—æ®µ
            loadEditAttributeFields(photo);
            
            document.getElementById('photo-modal').classList.add('active');
        }
        
        function loadPhotoCategoryDropdown(selectedId) {
            const select = document.getElementById('photo-category-edit');
            if (!select) return;
            
            select.innerHTML = '<option value="">é€‰æ‹©åˆ†ç±»</option>' + 
                categories.map(c => `<option value="${c.id}" ${c.id === selectedId ? 'selected' : ''}>${c.name}</option>`).join('');
        }
        
        function closePhotoModal() {
            document.getElementById('photo-modal').classList.remove('active');
        }
        
        async function loadEditAttributeFields(photo) {
            const container = document.getElementById('edit-attributes');
            if (!container) return;
            
            if (!attributes.length) {
                container.innerHTML = '<p style="color: #999; font-size: 13px;">æš‚æ— å±æ€§é…ç½®</p>';
                return;
            }
            
            const photoAttrs = photo?.attributes || {};
            
            container.innerHTML = attributes.map(attr => `
                <div class="attribute-item">
                    <label>${attr.name}${attr.unit ? ` (${attr.unit})` : ''}</label>
                    <input type="text" id="attr-edit-${attr.id}" value="${photoAttrs[attr.id] || ''}" placeholder="è¾“å…¥${attr.name}">
                    ${attr.description ? `<small style="color: #999;">${attr.description}</small>` : ''}
                </div>
            `).join('');
        }
        
        function initPhotoForm() {
            const form = document.getElementById('photo-form');
            console.log('[initPhotoForm] Form element:', form);
            if (!form) {
                console.error('[initPhotoForm] Form not found!');
                return;
            }
            
            console.log('[initPhotoForm] Attaching submit event listener...');
            
            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                console.log('[initPhotoForm] Submit event triggered!');
                
                const id = document.getElementById('photo-id').value;
                const isNew = !id;
                console.log('[initPhotoForm] id:', id, 'isNew:', isNew);
                
                // æ”¶é›†å±æ€§æ•°æ®
                const attributesData = {};
                attributes.forEach(attr => {
                    const value = document.getElementById(`attr-edit-${attr.id}`)?.value;
                    if (value) attributesData[attr.id] = value;
                });
                console.log('[initPhotoForm] attributesData:', attributesData);
                
                const photoData = {
                    title: document.getElementById('photo-title-edit').value,
                    category: document.getElementById('photo-category-edit').value,
                    year: parseInt(document.getElementById('photo-year-edit').value) || new Date().getFullYear(),
                    sort_order: parseInt(document.getElementById('photo-sort-edit').value) || 0,
                    description: document.getElementById('photo-description-edit').value,
                    is_active: document.getElementById('photo-active-edit').value === 'true',
                    attributes: attributesData
                };
                console.log('[initPhotoForm] photoData:', photoData);
                
                try {
                    let result;
                    if (isNew) {
                        // æ–°å»ºä½œå“ï¼ˆä¸å¤„ç†å›¾ç‰‡ä¸Šä¼ ï¼‰
                        console.log('[initPhotoForm] Creating new photo...');
                        result = await window.supabase.insert('photos', photoData);
                        showToast('ä½œå“å·²åˆ›å»º', 'success');
                    } else {
                        // æ›´æ–°ä½œå“
                        console.log('[initPhotoForm] Updating existing photo...');
                        result = await window.supabase.update('photos', id, photoData);
                        showToast('ä½œå“å·²æ›´æ–°', 'success');
                    }
                    
                    console.log('[initPhotoForm] Result:', result);
                    
                    if (result.error) throw result.error;
                    
                    closePhotoModal();
                    await loadPhotos();
                    await loadDashboard();
                } catch (error) {
                    console.error('[initPhotoForm] Save failed:', error);
                    showToast('ä¿å­˜å¤±è´¥: ' + error.message, 'error');
                }
            });
            
            console.log('[initPhotoForm] Event listener attached successfully');
        }

        async function deletePhoto(id) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªä½œå“å—ï¼Ÿ')) return;

            try {
                // è·å–ä½œå“ä¿¡æ¯ï¼Œç”¨äºåˆ é™¤å›¾ç‰‡
                const { data: photo, error: fetchError } = await window.supabase.getOne('photos', id);
                if (fetchError) throw fetchError;

                // åˆ é™¤å­˜å‚¨çš„å›¾ç‰‡æ–‡ä»¶
                if (photo) {
                    // åˆ é™¤åŸå›¾
                    if (photo.image_url && photo.image_url.includes('/storage/v1/object/')) {
                        await window.supabase.deletePhotoImage(photo.image_url);
                    }
                    // åˆ é™¤ç¼©ç•¥å›¾
                    if (photo.thumbnail_url && photo.thumbnail_url.includes('/storage/v1/object/')) {
                        await window.supabase.deletePhotoImage(photo.thumbnail_url);
                    }
                }

                // ä»æ•°æ®åº“åˆ é™¤è®°å½•
                const result = await window.supabase.delete('photos', id);
                if (result.error) throw result.error;

                showToast('ä½œå“å·²åˆ é™¤', 'success');
                await loadDashboard();
                await loadPhotos();
            } catch (error) {
                showToast('åˆ é™¤å¤±è´¥: ' + error.message, 'error');
            }
        }

        // About Me Page
        async function loadAbout() {
            console.log('[loadAbout] åŠ è½½å…³äºæˆ‘æ•°æ®...');
            try {
                const { data: aboutData, error } = await window.supabase.getAbout();
                console.log('[loadAbout] è·å–åˆ°çš„æ•°æ®:', aboutData);
                
                if (error) {
                    console.error('[loadAbout] è·å–æ•°æ®å¤±è´¥:', error);
                    return;
                }
                
                if (aboutData) {
                    document.getElementById('about-name').value = aboutData.name || '';
                    document.getElementById('about-title').value = aboutData.title || '';
                    document.getElementById('about-bio').value = aboutData.bio || '';
                    document.getElementById('about-contact').value = aboutData.contact || '';
                    
                    // æ˜¾ç¤ºå¤´åƒé¢„è§ˆ
                    if (aboutData.avatar_url) {
                        setImagePreview('avatar-upload', aboutData.avatar_url, 'about-avatar');
                    }
                    
                    // æ˜¾ç¤ºå°çº¢ä¹¦äºŒç»´ç é¢„è§ˆ
                    if (aboutData.xiaohongshu_qrcode) {
                        setImagePreview('xiaohongshu-upload', aboutData.xiaohongshu_qrcode, 'about-xiaohongshu');
                    }
                    
                    // æ˜¾ç¤ºBç«™äºŒç»´ç é¢„è§ˆ
                    if (aboutData.bilibili_qrcode) {
                        setImagePreview('bilibili-upload', aboutData.bilibili_qrcode, 'about-bilibili');
                    }
                }
            } catch (error) {
                console.error('åŠ è½½å…³äºæˆ‘ä¿¡æ¯å¤±è´¥:', error);
            }
        }
        
        // è®¾ç½®å›¾ç‰‡é¢„è§ˆçš„è¾…åŠ©å‡½æ•°
        function setImagePreview(containerId, imageUrl, inputId) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            // æ¸…é™¤ç°æœ‰å†…å®¹ï¼Œä¿ç•™æ–‡ä»¶è¾“å…¥
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.id = inputId;
            fileInput.accept = 'image/*';
            
            container.innerHTML = '';
            
            const img = document.createElement('img');
            img.src = imageUrl;
            img.alt = 'é¢„è§ˆ';
            img.style.cssText = 'width: 100%; height: 100%; object-fit: cover; border-radius: 8px;';
            
            container.appendChild(img);
            container.classList.add('has-image');
            container.appendChild(fileInput);
        }
        
        function initAboutForm() {
            console.log('[initAboutForm] åˆå§‹åŒ–å…³äºæˆ‘è¡¨å•...');
            const form = document.getElementById('about-form');
            if (!form) {
                console.error('[initAboutForm] è¡¨å•æœªæ‰¾åˆ°!');
                return;
            }
            
            // åˆå§‹åŒ–æ‰€æœ‰äºŒç»´ç é¢„è§ˆ
            initQRCodePreview('about-xiaohongshu', 'xiaohongshu-upload');
            initQRCodePreview('about-bilibili', 'bilibili-upload');
            
            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                console.log('[initAboutForm] æäº¤è¡¨å•...');
                
                const submitBtn = form.querySelector('button[type="submit"]');
                submitBtn.disabled = true;
                submitBtn.textContent = 'ä¿å­˜ä¸­...';
                
                try {
                    // æ”¶é›†æ•°æ®
                    const aboutData = {
                        name: document.getElementById('about-name').value,
                        title: document.getElementById('about-title').value,
                        bio: document.getElementById('about-bio').value,
                        contact: document.getElementById('about-contact').value
                    };
                    
                    // å¤„ç†å¤´åƒä¸Šä¼ 
                    const avatarInput = document.getElementById('about-avatar');
                    if (avatarInput && avatarInput.files && avatarInput.files.length > 0) {
                        console.log('[initAboutForm] ä¸Šä¼ å¤´åƒ...');
                        const avatarFile = avatarInput.files[0];

                        // ä¸Šä¼ å¤´åƒåˆ° Supabase Storage
                        const avatarResult = await window.supabase.uploadPhoto(avatarFile);
                        if (avatarResult.error) {
                            throw new Error('å¤´åƒä¸Šä¼ å¤±è´¥: ' + avatarResult.error.message);
                        }
                        aboutData.avatar_url = avatarResult.data.path;
                        console.log('[initAboutForm] å¤´åƒå·²ä¸Šä¼ åˆ° Supabase Storage');
                    } else {
                        // å¦‚æœæ²¡æœ‰ä¸Šä¼ æ–°å¤´åƒï¼Œä¿ç•™åŸæœ‰çš„URL
                        const { data: existingData } = await window.supabase.getAbout();
                        if (existingData && existingData.avatar_url) {
                            aboutData.avatar_url = existingData.avatar_url;
                            console.log('[initAboutForm] ä¿ç•™åŸæœ‰å¤´åƒURL');
                        }
                    }

                    // å¤„ç†å°çº¢ä¹¦äºŒç»´ç ä¸Šä¼ 
                    const xiaohongshuInput = document.getElementById('about-xiaohongshu');
                    if (xiaohongshuInput && xiaohongshuInput.files && xiaohongshuInput.files.length > 0) {
                        console.log('[initAboutForm] ä¸Šä¼ å°çº¢ä¹¦äºŒç»´ç ...');
                        const xhsFile = xiaohongshuInput.files[0];

                        // ä¸Šä¼ äºŒç»´ç åˆ° Supabase Storage
                        const xhsResult = await window.supabase.uploadPhoto(xhsFile);
                        if (xhsResult.error) {
                            throw new Error('å°çº¢ä¹¦äºŒç»´ç ä¸Šä¼ å¤±è´¥: ' + xhsResult.error.message);
                        }
                        aboutData.xiaohongshu_qrcode = xhsResult.data.path;
                        console.log('[initAboutForm] å°çº¢ä¹¦äºŒç»´ç å·²ä¸Šä¼ åˆ° Supabase Storage');
                    } else {
                        // å¦‚æœæ²¡æœ‰ä¸Šä¼ æ–°äºŒç»´ç ï¼Œä¿ç•™åŸæœ‰çš„URL
                        const { data: existingData } = await window.supabase.getAbout();
                        if (existingData && existingData.xiaohongshu_qrcode) {
                            aboutData.xiaohongshu_qrcode = existingData.xiaohongshu_qrcode;
                            console.log('[initAboutForm] ä¿ç•™åŸæœ‰å°çº¢ä¹¦äºŒç»´ç URL');
                        }
                    }

                    // å¤„ç†Bç«™äºŒç»´ç ä¸Šä¼ 
                    const bilibiliInput = document.getElementById('about-bilibili');
                    if (bilibiliInput && bilibiliInput.files && bilibiliInput.files.length > 0) {
                        console.log('[initAboutForm] ä¸Šä¼ Bç«™äºŒç»´ç ...');
                        const biliFile = bilibiliInput.files[0];

                        // ä¸Šä¼ äºŒç»´ç åˆ° Supabase Storage
                        const biliResult = await window.supabase.uploadPhoto(biliFile);
                        if (biliResult.error) {
                            throw new Error('Bç«™äºŒç»´ç ä¸Šä¼ å¤±è´¥: ' + biliResult.error.message);
                        }
                        aboutData.bilibili_qrcode = biliResult.data.path;
                        console.log('[initAboutForm] Bç«™äºŒç»´ç å·²ä¸Šä¼ åˆ° Supabase Storage');
                    } else {
                        // å¦‚æœæ²¡æœ‰ä¸Šä¼ æ–°äºŒç»´ç ï¼Œä¿ç•™åŸæœ‰çš„URL
                        const { data: existingData } = await window.supabase.getAbout();
                        if (existingData && existingData.bilibili_qrcode) {
                            aboutData.bilibili_qrcode = existingData.bilibili_qrcode;
                            console.log('[initAboutForm] ä¿ç•™åŸæœ‰Bç«™äºŒç»´ç URL');
                        }
                    }
                    
                    // ä¿å­˜åˆ°æ•°æ®åº“
                    console.log('[initAboutForm] å‡†å¤‡ä¿å­˜çš„æ•°æ®:');
                    console.log('- name:', document.getElementById('about-name').value || '(ç©º)');
                    console.log('- title:', document.getElementById('about-title').value || '(ç©º)');
                    console.log('- bio:', document.getElementById('about-bio').value ? '(æœ‰å†…å®¹)' : '(ç©º)');
                    console.log('- contact:', document.getElementById('about-contact').value ? '(æœ‰å†…å®¹)' : '(ç©º)');
                    console.log('- xiaohongshu_qrcode:', aboutData.xiaohongshu_qrcode ? `[å›¾ç‰‡æ•°æ®, ${aboutData.xiaohongshu_qrcode.length} å­—ç¬¦]` : '(ç©º)');
                    console.log('- bilibili_qrcode:', aboutData.bilibili_qrcode ? `[å›¾ç‰‡æ•°æ®, ${aboutData.bilibili_qrcode.length} å­—ç¬¦]` : '(ç©º)');
                    
                    // æ£€æŸ¥å½“å‰ localStorage ä½¿ç”¨æƒ…å†µ
                    console.log('[initAboutForm] æ£€æŸ¥ localStorage ä½¿ç”¨æƒ…å†µ...');
                    let totalSize = 0;
                    for (let i = 0; i < localStorage.length; i++) {
                        const key = localStorage.key(i);
                        const value = localStorage.getItem(key);
                        totalSize += (key.length + value.length) * 2; // UTF-16 ç¼–ç 
                        console.log(`  - ${key}: ${(value.length / 1024).toFixed(2)} KB`);
                    }
                    console.log(`[initAboutForm] localStorage æ€»ä½¿ç”¨é‡: ${(totalSize / 1024 / 1024).toFixed(2)} MB`);
                    
                    const { data, error } = await window.supabase.saveAbout(aboutData);
                    
                    if (error) {
                        console.error('[initAboutForm] ä¿å­˜å¤±è´¥:', error);
                        showToast('ä¿å­˜å¤±è´¥: ' + error.message, 'error');
                        return;
                    }
                    
                    console.log('[initAboutForm] âœ“ ä¿å­˜æˆåŠŸ!');
                    
                    // éªŒè¯ä¿å­˜ç»“æœ
                    const savedData = localStorage.getItem('about');
                    if (savedData) {
                        const parsed = JSON.parse(savedData);
                        console.log('[initAboutForm] âœ“ éªŒè¯æˆåŠŸï¼ä¿å­˜çš„å­—æ®µ:', Object.keys(parsed));
                        if (parsed.xiaohongshu_qrcode) {
                            console.log('[initAboutForm] âœ“ å°çº¢ä¹¦äºŒç»´ç å·²ä¿å­˜');
                        }
                        if (parsed.bilibili_qrcode) {
                            console.log('[initAboutForm] âœ“ Bç«™äºŒç»´ç å·²ä¿å­˜');
                        }
                    } else {
                        console.error('[initAboutForm] âŒ éªŒè¯å¤±è´¥ï¼šæ•°æ®æœªæ‰¾åˆ°ï¼');
                        showToast('ä¿å­˜éªŒè¯å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
                        return;
                    }
                    
                    showToast('å…³äºæˆ‘ä¿¡æ¯å·²ä¿å­˜!', 'success');
                    
                    // é‡æ–°åŠ è½½ä»¥æ˜¾ç¤ºæœ€æ–°å†…å®¹
                    await loadAbout();
                    
                    // é‡æ–°åˆå§‹åŒ–äºŒç»´ç é¢„è§ˆ
                    initQRCodePreview('about-xiaohongshu', 'xiaohongshu-upload');
                    initQRCodePreview('about-bilibili', 'bilibili-upload');
                } catch (error) {
                    console.error('[initAboutForm] ä¿å­˜å¤±è´¥:', error);
                    showToast('ä¿å­˜å¤±è´¥: ' + error.message, 'error');
                } finally {
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'ä¿å­˜ä¿®æ”¹';
                }
            });
            
            console.log('[initAboutForm] è¡¨å•åˆå§‹åŒ–å®Œæˆ');
        }
        
        // åˆå§‹åŒ–äºŒç»´ç é¢„è§ˆåŠŸèƒ½
        function initQRCodePreview(inputId, containerId) {
            const input = document.getElementById(inputId);
            const container = document.getElementById(containerId);
            
            if (!input || !container) return;
            
            input.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        // æ¸…é™¤ç°æœ‰å†…å®¹ï¼Œä¿ç•™æ–‡ä»¶è¾“å…¥
                        const currentInput = input;
                        container.innerHTML = '';
                        
                        const previewImg = document.createElement('img');
                        previewImg.src = e.target.result;
                        previewImg.alt = 'äºŒç»´ç é¢„è§ˆ';
                        previewImg.style.cssText = 'width: 100%; height: 100%; object-fit: contain; border-radius: 8px;';
                        
                        container.appendChild(previewImg);
                        container.classList.add('has-image');
                        
                        // é‡æ–°æ·»åŠ æ–‡ä»¶è¾“å…¥
                        container.appendChild(currentInput);
};
                    reader.readAsDataURL(file);
                }
            });
        }
        
        function initAvatarPreview() {
            const avatarInput = document.getElementById('about-avatar');
            const avatarUpload = document.getElementById('avatar-upload');
            
            if (!avatarInput || !avatarUpload) return;
            
            avatarInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        // æ¸…é™¤ç°æœ‰å†…å®¹ï¼Œä¿ç•™æ–‡ä»¶è¾“å…¥
                        const currentInput = avatarInput;
                        avatarUpload.innerHTML = '';
                        
                        const previewImg = document.createElement('img');
                        previewImg.src = e.target.result;
                        previewImg.alt = 'å¤´åƒé¢„è§ˆ';
                        previewImg.style.cssText = 'width: 100%; height: 100%; object-fit: cover; border-radius: 8px;';
                        
                        avatarUpload.appendChild(previewImg);
                        avatarUpload.classList.add('has-image');
                        
                        // é‡æ–°æ·»åŠ æ–‡ä»¶è¾“å…¥
                        avatarUpload.appendChild(currentInput);
                    };
                    reader.readAsDataURL(file);
                }
            });
        }

        // ============ Banner Management ============

        async function loadBanners() {
            const container = document.getElementById('banner-list');
            if (!container) return;

            container.innerHTML = '<div class="loading">åŠ è½½ä¸­...</div>';

            try {
                const { data: banners, error } = await window.supabase.getBanners();
                if (error) throw error;

                if (!banners || banners.length === 0) {
                    container.innerHTML = '<p style="color: #999; text-align: center; padding: 20px;">æš‚æ—  Banner å›¾ç‰‡</p>';
                    return;
                }

                container.innerHTML = banners.map((banner, index) => `
                    <div class="banner-item" data-id="${banner.id}">
                        <div class="banner-preview">
                            <img src="${banner.image_url}" alt="Banner ${index + 1}" onerror="this.src='https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=800'">
                        </div>
                        <div class="banner-info">
                            <div class="form-group">
                                <label>æ ‡é¢˜</label>
                                <input type="text" class="banner-title" value="${banner.title || ''}" placeholder="è¾“å…¥æ ‡é¢˜">
                            </div>
                            <div class="form-group">
                                <label>æè¿°</label>
                                <input type="text" class="banner-description" value="${banner.description || ''}" placeholder="è¾“å…¥æè¿°">
                            </div>
                            <div class="form-group">
                                <label>å›¾ç‰‡ä¸Šä¼ ï¼ˆé€‰æ‹©æ–‡ä»¶åè‡ªåŠ¨ä¿å­˜ï¼‰</label>
                                <input type="file" class="banner-upload" accept="image/*" style="width: 100%;">
                                <input type="hidden" class="banner-url" value="${banner.image_url}">
                                <small style="color: #666;">é€‰æ‹©å›¾ç‰‡åä¼šè‡ªåŠ¨ä¸Šä¼ å¹¶æ›´æ–°ï¼Œæ— éœ€æ‰‹åŠ¨ä¿å­˜</small>
                            </div>
                            <div style="display: flex; gap: 10px;">
                                <button class="btn btn-sm btn-danger" onclick="deleteBanner(${index})">åˆ é™¤</button>
                            </div>
                        </div>
                    </div>
                `).join('');

                // åˆå§‹åŒ–æ–‡ä»¶ä¸Šä¼ é¢„è§ˆ
                initBannerPreviews();
            } catch (error) {
                console.error('åŠ è½½ Banner å¤±è´¥:', error);
                container.innerHTML = '<p style="color: #dc3545;">åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•</p>';
            }
        }

        function initBannerPreviews() {
            const container = document.getElementById('banner-list');
            if (!container) return;

            const fileInputs = container.querySelectorAll('.banner-upload');
            fileInputs.forEach((input, index) => {
                input.addEventListener('change', async function(e) {
                    const file = e.target.files[0];
                    if (!file) return;

                    // è·å– bannerItemï¼ˆåœ¨äº‹ä»¶å¤„ç†å‡½æ•°é¡¶éƒ¨å®šä¹‰ï¼‰
                    const bannerItem = input.closest('.banner-item');
                    if (!bannerItem) {
                        console.error('[Banner] æœªæ‰¾åˆ° bannerItem å…ƒç´ ');
                        showToast('é”™è¯¯ï¼šæœªæ‰¾åˆ°Bannerå…ƒç´ ', 'error');
                        return;
                    }

                    // æ˜¾ç¤ºæœ¬åœ°é¢„è§ˆ
                    const reader = new FileReader();
                    reader.onload = function(e) {
const previewImg = bannerItem.querySelector('.banner-preview img');
                        if (previewImg) {
                            previewImg.src = e.target.result;
                        }
                    };
                    reader.readAsDataURL(file);

                    // è‡ªåŠ¨ä¸Šä¼ åˆ° Supabase å¹¶ä¿å­˜
                    try {
                        console.log('[Banner] å¼€å§‹ä¸Šä¼ æ–‡ä»¶:', file.name);
                        const result = await window.supabase.uploadAndCompress(file, 'banners', 'banner');
                        
                        if (result.error) {
                            console.error('[Banner] ä¸Šä¼ å¤±è´¥:', result.error);
                            showToast('ä¸Šä¼ å¤±è´¥: ' + result.error.message, 'error');
                            return;
                        }

                        console.log('[Banner] ä¸Šä¼ æˆåŠŸ:', result.data.path);

                        // æ›´æ–°éšè—çš„URLå­—æ®µ
                        const urlInput = bannerItem.querySelector('.banner-url');
                        if (urlInput) {
                            urlInput.value = result.data.path;
                        }

                        // æ›´æ–°é¢„è§ˆå›¾
                        const previewImg = bannerItem.querySelector('.banner-preview img');
                        if (previewImg) {
                            previewImg.src = result.data.path;
                        }

                        // ç«‹å³ä¿å­˜åˆ°æ•°æ®åº“
                        const { data: banners } = await window.supabase.getBanners();
                        const bannerIndex = Array.from(container.querySelectorAll('.banner-item')).indexOf(bannerItem);
                        
                        if (bannerIndex >= 0 && bannerIndex < banners.length) {
                            banners[bannerIndex] = {
                                ...banners[bannerIndex],
                                image_url: result.data.path
                            };

                            const { error: saveError } = await window.supabase.saveBanners(banners);
                            if (saveError) {
                                showToast('ä¿å­˜å¤±è´¥: ' + saveError.message, 'error');
                                return;
                            }

                            console.log('[Banner] å·²è‡ªåŠ¨ä¿å­˜');
                            showToast('âœ… å›¾ç‰‡å·²ä¸Šä¼ å¹¶ä¿å­˜', 'success');
                        } else {
                            console.error('[Banner] æ— æ•ˆçš„ bannerIndex:', bannerIndex);
                            showToast('ä¿å­˜å¤±è´¥ï¼šæ— æ•ˆçš„Bannerç´¢å¼•', 'error');
                        }
                    } catch (error) {
                        console.error('[Banner] ä¸Šä¼ å¼‚å¸¸:', error);
                        showToast('ä¸Šä¼ å¤±è´¥: ' + error.message, 'error');
                    }
                });
            });
        }

        async function addBannerItem() {
            const container = document.getElementById('banner-list');
            const { data: banners } = await window.supabase.getBanners();

            const newBanner = {
                id: Date.now(),
                image_url: 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=1920',
                title: 'æ–°å›¾ç‰‡',
                description: 'æ·»åŠ æ–°çš„æè¿°',
                sort_order: banners.length + 1
            };

            banners.push(newBanner);
            await window.supabase.saveBanners(banners);
            await loadBanners();
            showToast('å·²æ·»åŠ æ–°çš„ Banner', 'success');
        }

        async function saveSingleBanner(index) {
            const container = document.getElementById('banner-list');
            const bannerItems = container.querySelectorAll('.banner-item');
            const bannerItem = bannerItems[index];

            const bannerData = {
                image_url: bannerItem.querySelector('.banner-url').value,
                title: bannerItem.querySelector('.banner-title').value,
                description: bannerItem.querySelector('.banner-description').value
            };

            if (!bannerData.image_url) {
                showToast('è¯·ä¸Šä¼ æˆ–è¾“å…¥å›¾ç‰‡ URL', 'error');
                return;
            }

            const { data: banners } = await window.supabase.getBanners();
            banners[index] = { ...banners[index], ...bannerData };

            const { error } = await window.supabase.saveBanners(banners);
            if (error) {
                showToast('ä¿å­˜å¤±è´¥: ' + error.message, 'error');
                return;
            }

            showToast('Banner å·²ä¿å­˜', 'success');
        }

        async function deleteBanner(index) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ª Banner å—ï¼Ÿ')) return;

            const { data: banners } = await window.supabase.getBanners();
            banners.splice(index, 1);

            // é‡æ–°æ’åº
            banners.forEach((banner, i) => {
                banner.sort_order = i + 1;
            });

            const { error } = await window.supabase.saveBanners(banners);
            if (error) {
                showToast('åˆ é™¤å¤±è´¥: ' + error.message, 'error');
                return;
            }

            await loadBanners();
            showToast('Banner å·²åˆ é™¤', 'success');
        }

        // Data management
        async function exportData() {
            const { data: photos } = await window.supabase.select('photos');
            const blob = new Blob([JSON.stringify(photos, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `photos-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            showToast('æ•°æ®å·²å¯¼å‡º', 'success');
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = async function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = async function(e) {
                        try {
                            const photos = JSON.parse(e.target.result);
                            for (const photo of photos) {
                                delete photo.id;
                                await window.supabase.insert('photos', photo);
                            }
                            showToast(`æˆåŠŸå¯¼å…¥ ${photos.length} æ¡æ•°æ®`, 'success');
                            await loadDashboard();
                            await loadPhotos();
                        } catch (error) {
                            showToast('å¯¼å…¥å¤±è´¥: ' + error.message, 'error');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        function clearData() {
            if (!confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼')) return;
            
            localStorage.removeItem('photos');
            localStorage.removeItem('categories');
            localStorage.removeItem('attributes');
            showToast('æ•°æ®å·²æ¸…ç©º', 'success');
            location.reload();
        }

        // Toast notifications
        function showToast(message, type = 'info') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Search and filter
        document.getElementById('search-photos')?.addEventListener('input', debounce(loadPhotos, 300));
        document.getElementById('filter-category')?.addEventListener('change', loadPhotos);

        function debounce(func, wait) {
            let timeout;
            return function(...args) {
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(this, args), wait);
            };
        }

        // Close modals on overlay click
        document.querySelectorAll('.modal-overlay').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.remove('active');
                }
            });
        });

        // Initialize Banner management when settings page is shown
        const settingsNavItem = document.querySelector('.nav-item[data-page="settings"]');
        if (settingsNavItem) {
            settingsNavItem.addEventListener('click', async function() {
                await loadBanners();
            });
        }
    

    

    async function loadCurrentUsername() {
        try {
            // ä» localStorage ç›´æ¥è¯»å–ç”¨æˆ·é…ç½®
            const userConfig = localStorage.getItem('admin_user_config');
            if (userConfig) {
                const config = JSON.parse(userConfig);
                document.getElementById('current-username').textContent = config.username;
                document.getElementById('current-username-input').value = config.username;
            } else {
                // é»˜è®¤ç”¨æˆ·å
                document.getElementById('current-username').textContent = 'admin';
                document.getElementById('current-username-input').value = 'admin';
            }
        } catch (error) {
            console.error('[Account] åŠ è½½ç”¨æˆ·åå¤±è´¥:', error);
        }
    }

     else if (strength <= 4) {
            strengthBar.classList.add('medium');
        } else {
            strengthBar.classList.add('strong');
        }
    }

    

        if (newUsername !== confirmUsername) {
            showToast('ä¸¤æ¬¡è¾“å…¥çš„ç”¨æˆ·åä¸ä¸€è‡´', 'error');
            return;
        }

        // è·å–å½“å‰ç”¨æˆ·å
        const userConfig = localStorage.getItem('admin_user_config');
        const currentConfig = userConfig ? JSON.parse(userConfig) : { username: 'admin' };
        
        if (currentConfig.username === newUsername) {
            showToast('æ–°ç”¨æˆ·åä¸å½“å‰ç”¨æˆ·åç›¸åŒ', 'error');
            return;
        }

        try {
            // ç›´æ¥æ›´æ–° localStorage ä¸­çš„ç”¨æˆ·é…ç½®
            const newConfig = {
                ...currentConfig,
                username: newUsername
            };
            localStorage.setItem('admin_user_config', JSON.stringify(newConfig));

            showToast('ç”¨æˆ·åå·²æˆåŠŸæ›´æ–°ï¼', 'success');

            // é‡ç½®è¡¨å•
            document.getElementById('username-form').reset();

            // æ›´æ–°æ˜¾ç¤ºçš„ç”¨æˆ·å
            loadCurrentUsername();
        } catch (error) {
            console.error('[Account] æ›´æ–°ç”¨æˆ·åå¤±è´¥:', error);
            showToast('æ›´æ–°å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', 'error');
        }
    }

    

        if (!newPassword || newPassword.length < 6) {
            showToast('æ–°å¯†ç è‡³å°‘éœ€è¦6ä¸ªå­—ç¬¦', 'error');
            return;
        }

        if (newPassword !== confirmNewPassword) {
            showToast('ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´', 'error');
            return;
        }

        // è·å–å½“å‰å¯†ç é…ç½®
        const userConfig = localStorage.getItem('admin_user_config');
        const currentConfig = userConfig ? JSON.parse(userConfig) : { password_hash: '' };
        
        // è®¡ç®—å½“å‰è¾“å…¥å¯†ç çš„å“ˆå¸Œ
        const inputHash = window.supabase.hashPassword(currentPassword);
        
        // éªŒè¯å½“å‰å¯†ç 
        if (currentConfig.password_hash && inputHash !== currentConfig.password_hash) {
            showToast('å½“å‰å¯†ç ä¸æ­£ç¡®', 'error');
            return;
        }

        // ä¸èƒ½ä¸å½“å‰å¯†ç ç›¸åŒ
        if (currentConfig.password_hash && inputHash === window.supabase.hashPassword(newPassword)) {
            showToast('æ–°å¯†ç ä¸èƒ½ä¸å½“å‰å¯†ç ç›¸åŒ', 'error');
            return;
        }

        try {
            // è®¡ç®—æ–°å¯†ç çš„å“ˆå¸Œ
            const newPasswordHash = window.supabase.hashPassword(newPassword);
            
            // æ›´æ–° localStorage ä¸­çš„ç”¨æˆ·é…ç½®
            const newConfig = {
                ...currentConfig,
                password_hash: newPasswordHash
            };
            localStorage.setItem('admin_user_config', JSON.stringify(newConfig));

            showToast('å¯†ç å·²æˆåŠŸæ›´æ–°ï¼', 'success');

            // é‡ç½®è¡¨å•
            document.getElementById('password-form').reset();
            updatePasswordStrength('');
        } catch (error) {
            console.error('[Account] æ›´æ–°å¯†ç å¤±è´¥:', error);
            showToast('æ›´æ–°å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', 'error');
        }
    }
</script>
</body>
</html>
