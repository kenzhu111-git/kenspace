<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LocalStorage æµ‹è¯•å·¥å…·</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-section h3 {
            margin-top: 0;
            color: #666;
        }
        button {
            background: #4a90d9;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background: #357abd;
        }
        .log {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Consolas', monospace;
            font-size: 13px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-break: break-all;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
        .status.info {
            background: #cce5ff;
            color: #004085;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ§ª LocalStorage æµ‹è¯•å·¥å…·</h1>
        
        <div class="test-section">
            <h3>1. æµ‹è¯• localStorage å¯ç”¨æ€§</h3>
            <button onclick="testLocalStorage()">æµ‹è¯• localStorage</button>
            <div id="test1-result"></div>
        </div>
        
        <div class="test-section">
            <h3>2. æµ‹è¯•æ•°æ®ä¿å­˜å’Œè¯»å–</h3>
            <button onclick="testSaveRead()">ä¿å­˜æµ‹è¯•æ•°æ®</button>
            <button onclick="clearTestData()">æ¸…é™¤æµ‹è¯•æ•°æ®</button>
            <div id="test2-result"></div>
        </div>
        
        <div class="test-section">
            <h3>3. æµ‹è¯•ç…§ç‰‡æ•°æ®å­˜å‚¨</h3>
            <button onclick="testPhotoStorage()">æµ‹è¯•ç…§ç‰‡å­˜å‚¨</button>
            <button onclick="viewPhotoData()">æŸ¥çœ‹å½“å‰ç…§ç‰‡æ•°æ®</button>
            <button onclick="clearPhotoData()">æ¸…é™¤ç…§ç‰‡æ•°æ®</button>
            <div id="test3-result"></div>
        </div>
        
        <div class="test-section">
            <h3>æ§åˆ¶å°æ—¥å¿—</h3>
            <button onclick="copyLogs()">å¤åˆ¶æ—¥å¿—</button>
            <button onclick="clearLogs()">æ¸…é™¤æ—¥å¿—</button>
            <div class="log" id="console-log">æ—¥å¿—å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</div>
        </div>
    </div>
    
    <script>
        const logElement = document.getElementById('console-log');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'error' ? 'âŒ' : type === 'success' ? 'âœ…' : 'â„¹ï¸';
            const logMessage = `[${timestamp}] ${prefix} ${message}\n`;
            
            logElement.textContent += logMessage;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(message);
        }
        
        function showStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="status ${type}">${message}</div>`;
        }
        
        function testLocalStorage() {
            log('å¼€å§‹æµ‹è¯• localStorage å¯ç”¨æ€§...');
            
            try {
                // æµ‹è¯•åŸºæœ¬æ“ä½œ
                const testKey = '__localstorage_test__';
                const testValue = 'test_value_' + Date.now();
                
                log('å°è¯•å†™å…¥æµ‹è¯•æ•°æ®...');
                localStorage.setItem(testKey, testValue);
                log('âœ“ å†™å…¥æˆåŠŸ');
                
                log('å°è¯•è¯»å–æµ‹è¯•æ•°æ®...');
                const retrievedValue = localStorage.getItem(testKey);
                log('âœ“ è¯»å–æˆåŠŸ');
                
                if (retrievedValue === testValue) {
                    log('âœ“ æ•°æ®éªŒè¯é€šè¿‡');
                    showStatus('test1-result', 'âœ… localStorage æ­£å¸¸å·¥ä½œï¼æ•°æ®å¯ä»¥æ­£å¸¸ä¿å­˜å’Œè¯»å–ã€‚', 'success');
                } else {
                    log('âŒ æ•°æ®éªŒè¯å¤±è´¥');
                    showStatus('test1-result', 'âŒ localStorage æ•°æ®éªŒè¯å¤±è´¥ï¼è¯»å–çš„æ•°æ®ä¸å†™å…¥çš„æ•°æ®ä¸åŒ¹é…ã€‚', 'error');
                }
                
                // æ¸…ç†æµ‹è¯•æ•°æ®
                localStorage.removeItem(testKey);
                log('âœ“ æµ‹è¯•æ•°æ®å·²æ¸…ç†');
                
            } catch (error) {
                log(`âŒ localStorage ä¸å¯ç”¨: ${error.message}`, 'error');
                log(`é”™è¯¯ç±»å‹: ${error.name}`, 'error');
                showStatus('test1-result', `âŒ localStorage ä¸å¯ç”¨ï¼<br>é”™è¯¯ä¿¡æ¯: ${error.message}<br>è¿™å¯èƒ½æ˜¯å› ä¸ºï¼š<br>1. æµè§ˆå™¨å¤„äºéšç§æ¨¡å¼<br>2. å­˜å‚¨ç©ºé—´å·²æ»¡<br>3. æµè§ˆå™¨ç¦ç”¨äº† localStorage`, 'error');
            }
        }
        
        function testSaveRead() {
            log('å¼€å§‹æµ‹è¯•æ•°æ®ä¿å­˜å’Œè¯»å–...');
            
            try {
                const testData = {
                    id: 'test_' + Date.now(),
                    title: 'æµ‹è¯•ç…§ç‰‡',
                    category: 'digital',
                    year: 2024,
                    description: 'è¿™æ˜¯ä¸€æ¡æµ‹è¯•æ•°æ®',
                    thumbnail_url: 'data:image/jpeg;base64,test',
                    image_url: 'data:image/jpeg;base64,test',
                    is_active: true,
                    sort_order: 999,
                    attributes: {},
                    created_at: new Date().toISOString()
                };
                
                log('åˆ›å»ºæµ‹è¯•æ•°æ®å¯¹è±¡...');
                log(`æµ‹è¯•æ•°æ® ID: ${testData.id}`);
                log(`æµ‹è¯•æ•°æ®æ ‡é¢˜: ${testData.title}`);
                
                // æ¨¡æ‹Ÿ supabaseClient.photos
                window.testPhotos = [];
                window.testPhotos.push(testData);
                log(`å½“å‰ photos æ•°ç»„é•¿åº¦: ${window.testPhotos.length}`);
                
                // ä¿å­˜åˆ° localStorage
                log('ä¿å­˜åˆ° localStorage...');
                const dataToSave = JSON.stringify(window.testPhotos);
                log(`æ•°æ®é•¿åº¦: ${dataToSave.length} å­—ç¬¦`);
                localStorage.setItem('test_photos', dataToSave);
                log('âœ“ ä¿å­˜æˆåŠŸ');
                
                // é‡æ–°è¯»å–
                log('ä» localStorage é‡æ–°è¯»å–...');
                const savedData = localStorage.getItem('test_photos');
                log(`è¯»å–åˆ°çš„æ•°æ®é•¿åº¦: ${savedData ? savedData.length : 0} å­—ç¬¦`);
                
                if (savedData) {
                    const parsedData = JSON.parse(savedData);
                    log(`è§£æåçš„æ•°ç»„é•¿åº¦: ${parsedData.length}`);
                    log(`è§£æåçš„ç¬¬ä¸€ä¸ªå…ƒç´ æ ‡é¢˜: ${parsedData[0]?.title}`);
                    
                    if (parsedData.length === window.testPhotos.length && 
                        parsedData[0]?.title === testData.title) {
                        log('âœ“ æ•°æ®ä¿å­˜å’Œè¯»å–æµ‹è¯•å®Œå…¨é€šè¿‡ï¼');
showStatus('test2-result', `âœ… æ•°æ®ä¿å­˜å’Œè¯»å–æµ‹è¯•é€šè¿‡ï¼<br>ä¿å­˜äº† ${parsedData.length} æ¡æ•°æ®`, 'success');
                    } else {
                        log('âŒ æ•°æ®éªŒè¯å¤±è´¥');
                        showStatus('test2-result', 'âŒ æ•°æ®éªŒè¯å¤±è´¥ï¼ä¿å­˜çš„æ•°æ®ä¸è¯»å–çš„æ•°æ®ä¸åŒ¹é…ã€‚', 'error');
                    }
                } else {
                    log('âŒ æ— æ³•è¯»å–ä¿å­˜çš„æ•°æ®');
                    showStatus('test2-result', 'âŒ æ— æ³•è¯»å–ä¿å­˜çš„æ•°æ®ï¼', 'error');
                }
                
            } catch (error) {
                log(`âŒ æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                showStatus('test2-result', `âŒ æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        function clearTestData() {
            log('æ¸…é™¤æµ‹è¯•æ•°æ®...');
            localStorage.removeItem('test_photos');
            window.testPhotos = [];
            log('âœ“ æµ‹è¯•æ•°æ®å·²æ¸…é™¤');
            showStatus('test2-result', 'ğŸ—‘ï¸ æµ‹è¯•æ•°æ®å·²æ¸…é™¤', 'info');
        }
        
        function testPhotoStorage() {
            log('å¼€å§‹æµ‹è¯•ç…§ç‰‡æ•°æ®å­˜å‚¨...');
            
            try {
                // æ£€æŸ¥å½“å‰ç…§ç‰‡æ•°æ®
                const currentPhotos = localStorage.getItem('photos');
                log(`å½“å‰ localStorage ä¸­çš„ç…§ç‰‡æ•°æ®: ${currentPhotos ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'}`);
                
                if (currentPhotos) {
                    const parsedPhotos = JSON.parse(currentPhotos);
                    log(`å½“å‰ç…§ç‰‡æ•°é‡: ${parsedPhotos.length}`);
                    
                    // æ·»åŠ æµ‹è¯•ç…§ç‰‡
                    const testPhoto = {
                        id: 'test_photo_' + Date.now(),
                        title: 'æµ‹è¯•ä¸Šä¼ çš„ç…§ç‰‡ ' + new Date().toLocaleTimeString(),
                        category: 'digital',
                        year: 2024,
                        description: 'è¿™æ˜¯ä¸€å¼ æµ‹è¯•ç…§ç‰‡ï¼Œç”¨äºéªŒè¯ä¸Šä¼ åŠŸèƒ½',
                        thumbnail_url: 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEASABIAAD/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAxNDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjL/wAARCAABAAEDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAn/xAAUEAEAAAAAAAAAAAAAAAAAAAAA/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAX/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwCwAB//2Q==',
                        image_url: 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEASABIAAD/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAxNDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjL/wAARCAABAAEDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAn/xAAUEAEAAAAAAAAAAAAAAAAAAAAA/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAX/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwCwAB//2Q==',
                        is_active: true,
                        sort_order: parsedPhotos.length + 1,
                        attributes: { size: '30x40' },
                        created_at: new Date().toISOString()
                    };
                    
                    parsedPhotos.push(testPhoto);
                    log(`æ·»åŠ æµ‹è¯•ç…§ç‰‡åçš„æ•°é‡: ${parsedPhotos.length}`);
                    
                    // ä¿å­˜
                    const newData = JSON.stringify(parsedPhotos);
                    log(`æ–°æ•°æ®é•¿åº¦: ${newData.length} å­—ç¬¦`);
                    localStorage.setItem('photos', newData);
                    log('âœ“ æµ‹è¯•ç…§ç‰‡å·²ä¿å­˜');
                    
                    // éªŒè¯
                    const verifyPhotos = localStorage.getItem('photos');
                    if (verifyPhotos) {
                        const parsedVerify = JSON.parse(verifyPhotos);
                        log(`éªŒè¯: å½“å‰ç…§ç‰‡æ•°é‡: ${parsedVerify.length}`);
                        
                        if (parsedVerify.length === parsedPhotos.length) {
                            log('âœ“ ç…§ç‰‡å­˜å‚¨æµ‹è¯•é€šè¿‡ï¼');
                            showStatus('test3-result', `âœ… ç…§ç‰‡å­˜å‚¨æµ‹è¯•é€šè¿‡ï¼<br>å½“å‰å…±æœ‰ ${parsedVerify.length} å¼ ç…§ç‰‡`, 'success');
                        } else {
                            log('âŒ ç…§ç‰‡æ•°é‡ä¸åŒ¹é…');
                            showStatus('test3-result', 'âŒ ç…§ç‰‡æ•°é‡ä¸åŒ¹é…ï¼', 'error');
                        }
                    }
                } else {
                    log('âš ï¸ localStorage ä¸­æ²¡æœ‰ç…§ç‰‡æ•°æ®');
                    showStatus('test3-result', 'âš ï¸ localStorage ä¸­æ²¡æœ‰ç…§ç‰‡æ•°æ®ï¼Œè¯·å…ˆä¸Šä¼ ä¸€å¼ ç…§ç‰‡', 'info');
                }
                
            } catch (error) {
                log(`âŒ æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                showStatus('test3-result', `âŒ æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        function viewPhotoData() {
            log('æŸ¥çœ‹å½“å‰ç…§ç‰‡æ•°æ®...');
            
            try {
                const photos = localStorage.getItem('photos');
                if (photos) {
                    const parsedPhotos = JSON.parse(photos);
                    log(`ç…§ç‰‡æ€»æ•°: ${parsedPhotos.length}`);
                    
                    parsedPhotos.forEach((photo, index) => {
                        log(`ç…§ç‰‡ ${index + 1}: ${photo.title} (${photo.category})`);
                    });
                    
                    showStatus('test3-result', `ğŸ“¸ å½“å‰å…±æœ‰ ${parsedPhotos.length} å¼ ç…§ç‰‡`, 'info');
                } else {
                    log('âš ï¸ æ²¡æœ‰æ‰¾åˆ°ç…§ç‰‡æ•°æ®');
                    showStatus('test3-result', 'âš ï¸ æ²¡æœ‰æ‰¾åˆ°ç…§ç‰‡æ•°æ®', 'info');
                }
            } catch (error) {
                log(`âŒ æŸ¥çœ‹å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        function clearPhotoData() {
            log('æ¸…é™¤ç…§ç‰‡æ•°æ®...');
            localStorage.removeItem('photos');
            log('âœ“ ç…§ç‰‡æ•°æ®å·²æ¸…é™¤');
            showStatus('test3-result', 'ğŸ—‘ï¸ ç…§ç‰‡æ•°æ®å·²æ¸…é™¤ï¼ˆå°†ä½¿ç”¨é»˜è®¤æ•°æ®ï¼‰', 'info');
        }
        
        function copyLogs() {
            const logs = logElement.textContent;
            navigator.clipboard.writeText(logs).then(() => {
                log('âœ“ æ—¥å¿—å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
            }).catch(() => {
                log('âŒ å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©å¤åˆ¶');
            });
        }
        
        function clearLogs() {
            logElement.textContent = 'æ—¥å¿—å·²æ¸…é™¤...\n';
            log('æ—¥å¿—å·²æ¸…é™¤');
        }
        
        // åˆå§‹åŒ–
        log('ğŸ§ª LocalStorage æµ‹è¯•å·¥å…·å·²å°±ç»ª');
        log('è¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æµ‹è¯•:');
        log('1. ç‚¹å‡»"æµ‹è¯• localStorage"æ£€æŸ¥æµè§ˆå™¨å­˜å‚¨åŠŸèƒ½');
        log('2. ç‚¹å‡»"æµ‹è¯•ç…§ç‰‡å­˜å‚¨"éªŒè¯ç…§ç‰‡æ•°æ®ä¿å­˜');
        log('3. å¦‚æœæµ‹è¯•å¤±è´¥ï¼Œè¯·å¤åˆ¶æ—¥å¿—å¹¶å‘é€ç»™å¼€å‘è€…');
    </script>
</body>
</html>
